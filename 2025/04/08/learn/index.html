<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Node 学习笔记 | Pulse Blog</title><meta name="author" content="DH"><meta name="copyright" content="DH"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Node.js使用 npm 安装第三方工具时。当父文件夹存在 node_modules 文件夹时，并执行下载命令时（在子文件夹下），将会自动下载第三方工具到父文件夹下的 node_modules 文件夹中。 path 模块resolve 将会从后往前解析路径，当遇到绝对路径将会停止 123456789101112131415const path &#x3D; require(&#x27;path&#x27;">
<meta property="og:type" content="article">
<meta property="og:title" content="Node 学习笔记">
<meta property="og:url" content="http://localhost:4000/2025/04/08/learn/index.html">
<meta property="og:site_name" content="Pulse Blog">
<meta property="og:description" content="Node.js使用 npm 安装第三方工具时。当父文件夹存在 node_modules 文件夹时，并执行下载命令时（在子文件夹下），将会自动下载第三方工具到父文件夹下的 node_modules 文件夹中。 path 模块resolve 将会从后往前解析路径，当遇到绝对路径将会停止 123456789101112131415const path &#x3D; require(&#x27;path&#x27;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://localhost:4000/images/favicon.ico">
<meta property="article:published_time" content="2025-04-08T15:31:42.000Z">
<meta property="article:modified_time" content="2025-09-03T15:26:27.932Z">
<meta property="article:author" content="DH">
<meta property="article:tag" content="Node">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/favicon.ico"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Node 学习笔记",
  "url": "http://localhost:4000/2025/04/08/learn/",
  "image": "http://localhost:4000/images/favicon.ico",
  "datePublished": "2025-04-08T15:31:42.000Z",
  "dateModified": "2025-09-03T15:26:27.932Z",
  "author": [
    {
      "@type": "Person",
      "name": "DH",
      "url": "http://localhost:4000"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.ico"><link rel="canonical" href="http://localhost:4000/2025/04/08/learn/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Node 学习笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/favicon.ico" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/favicon.ico" alt="Logo"><span class="site-name">Pulse Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Node 学习笔记</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Node 学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-04-08T15:31:42.000Z" title="Created 2025-04-08 23:31:42">2025-04-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-09-03T15:26:27.932Z" title="Updated 2025-09-03 23:26:27">2025-09-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h2><p>使用 npm 安装第三方工具时。当父文件夹存在 node_modules 文件夹时，并执行下载命令时（在子文件夹下），将会自动下载第三方工具到父文件夹下的 node_modules 文件夹中。</p>
<h3 id="path-模块"><a href="#path-模块" class="headerlink" title="path 模块"></a>path 模块</h3><p>resolve 将会从后往前解析路径，当遇到绝对路径将会停止</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">join</span>(<span class="string">&#x27;./a.txt&#x27;</span>, <span class="string">&#x27;./b&#x27;</span>)) <span class="comment">// a.txt\b</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">resolve</span>(<span class="string">&#x27;/a.txt&#x27;</span>, <span class="string">&#x27;./b&#x27;</span>, <span class="string">&#x27;/c.txt&#x27;</span>)) <span class="comment">// D:\c.txt</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">resolve</span>(<span class="string">&#x27;/a.txt&#x27;</span>, <span class="string">&#x27;/b.txt&#x27;</span>, <span class="string">&#x27;./c.txt&#x27;</span>)) <span class="comment">// D:\b.txt\c.txt</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">resolve</span>(<span class="string">&#x27;/a.txt&#x27;</span>, <span class="string">&#x27;./b.txt&#x27;</span>, <span class="string">&#x27;./c.txt&#x27;</span>)) <span class="comment">// D:\a.txt\b.txt\c.txt</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">resolve</span>(<span class="string">&#x27;./a.txt&#x27;</span>, <span class="string">&#x27;./b.txt&#x27;</span>, <span class="string">&#x27;./c.txt&#x27;</span>)) <span class="comment">// D:\Dahui\Project\Algorithm-Exercise\u-front\npm\src\a.txt\b.txt\c.txt</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">resolve</span>(<span class="string">&#x27;./a.txt&#x27;</span>, <span class="string">&#x27;./b.txt&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;./c.txt/&#x27;</span>)) <span class="comment">// D:\Dahui\Project\Algorithm-Exercise\u-front\npm\src\a.txt\b.txt\c.txt</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(__dirname, __filename) <span class="comment">// D:\Dahui\Project\Algorithm-Exercise\u-front\npm\src D:\Dahui\Project\Algorithm-Exercise\u-front\npm\src\index.js</span></span><br></pre></td></tr></table></figure>



<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><h3 id="exports-与-module-exports"><a href="#exports-与-module-exports" class="headerlink" title="exports 与 module.exports"></a><code>exports</code> 与 <code>module.exports</code></h3><p><code>exports</code> 和 <code>module.exports</code> 等价</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">module</span>.<span class="property">exports</span> === <span class="built_in">exports</span>)</span><br></pre></td></tr></table></figure>

<p>执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node b.js</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="路径查找问题"><a href="#路径查找问题" class="headerlink" title="路径查找问题"></a>路径查找问题</h3><p>在使用 <code>require(&#39;路径&#39;)</code> 时，当路径前缀不包含 <code>/</code>、<code>./</code>、<code>../</code> 等相对或绝对路径时</p>
<ul>
<li>将会首先在 node.js 的环境中查找该模块，例如：<code>require(&#39;path&#39;)</code> </li>
<li>当 node.js 环境不存在该模块时，将会在该目录的 node_modules 文件夹中查找，该目录中不存在 node_modules 文件夹则会一直向上寻找该文件夹，不存在则抛出异常</li>
</ul>
<p>当路径前缀包含 <code>/</code>、<code>./</code>、<code>../</code> 等相对或绝对路径时，首先会查找其路径对应的文件，当不存在该文件时：</p>
<ul>
<li>当不包含文件后缀名 (<code>.js</code>、<code>.json</code>、<code>.node</code>) 时，将会自动添加后缀，进行查找</li>
<li>当添加后缀名后查找仍不存在，则会查找该路径命名的文件夹，当不存在该文件夹时抛出异常</li>
<li>当文件夹存在时，则会在文件夹中查找 <code>index.js</code> 文件</li>
</ul>
<h3 id="导出引用"><a href="#导出引用" class="headerlink" title="导出引用"></a>导出引用</h3><p>在使用 <code>require</code> 和 <code>module.exports</code> 时，<code>module.exports</code> 所导出的为对象的引用，在导入文件中修改导入的变量时，原变量也会发生改变</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;in aaa file: &#x27;</span>, a.<span class="property">name</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">const</span> ma = <span class="built_in">require</span>(<span class="string">&#x27;./aaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;in bbb file: &#x27;</span>, ma)</span><br><span class="line"></span><br><span class="line">ma.<span class="property">a</span>.<span class="property">name</span> = <span class="string">&#x27;bbb&#x27;</span></span><br></pre></td></tr></table></figure>

<p>当执行后：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ node b.js</span><br><span class="line"><span class="keyword">in</span> bbb file:  &#123; a: &#123; name: <span class="string">&#x27;aaa&#x27;</span> &#125; &#125;</span><br><span class="line"><span class="keyword">in</span> aaa file:  bbb</span><br></pre></td></tr></table></figure>

<h3 id="module-对象"><a href="#module-对象" class="headerlink" title="module 对象"></a>module 对象</h3><p>当模块使用 require 引入时，该模块中的代码将会被自动执行一次。当多次引入也会只执行一次。</p>
<p>node.js 源码中存在一个变量 <code>module.loaded</code> ，初始时为 false，当进行引入时该变量将会变为 true</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Module</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;~&#x27;</span>,</span><br><span class="line">  <span class="attr">exports</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&#x27;~/aaa.js&#x27;</span>,</span><br><span class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>, <span class="comment">// 代表是否已经加载该模块</span></span><br><span class="line">  <span class="attr">children</span>: [],</span><br><span class="line">  <span class="attr">paths</span>: [ <span class="comment">// 当前目录及父目录下的 node_modules 文件夹，用于查找第三方工具包</span></span><br><span class="line">    <span class="string">&#x27;D:\\Dahui\\Project\\Algorithm-Exercise\\node_modules&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D:\\Dahui\\Project\\node_modules&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D:\\Dahui\\node_modules&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D:\\node_modules&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="加载过程"><a href="#加载过程" class="headerlink" title="加载过程"></a>加载过程</h3><p>其加载过程为同步过程，当一个模块加载完成之后，才会加载另一个，此方法经常在服务端使用（由于本地加载较为迅速）。此种方式在客户端加载时会导致卡顿或阻塞。由此引申出 AMD（Asynchronous Module Definition） 和 CMD （Common Module Definition），这两种方式都采用异步加载</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;in aaa file&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;in bbb file&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> ma = <span class="built_in">require</span>(<span class="string">&#x27;./a&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;in bbb file&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ node b.js</span><br><span class="line"><span class="keyword">in</span> bbb file</span><br><span class="line"><span class="keyword">in</span> aaa file</span><br><span class="line"><span class="keyword">in</span> bbb file</span><br></pre></td></tr></table></figure>

<p>当存在循环引入时，其执行顺序（node.js 为深度优先搜索）</p>
<ul>
<li>a -&gt; b -&gt; c</li>
<li>a -&gt; d -&gt; c</li>
</ul>
<p>则执行顺序为：a -&gt; b -&gt; c -&gt; d</p>
<h2 id="ES-Module"><a href="#ES-Module" class="headerlink" title="ES-Module"></a>ES-Module</h2><p>在 ES6（ES2015） 时推出</p>
<h3 id="导入导出方式"><a href="#导入导出方式" class="headerlink" title="导入导出方式"></a>导入导出方式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="string">&quot;aaa&quot;</span></span><br><span class="line"><span class="comment">// 定义时直接导出，该方式不能使用 as 关键字改别名</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> aa = <span class="string">&quot;aaaaaa&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">	a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="comment">// 在浏览器中导入时，必须夹后缀（.js），导入声明只能在文件顶层使用</span></span><br><span class="line"><span class="keyword">import</span> &#123;a&#125; <span class="keyword">from</span> <span class="string">&#x27;a.js&#x27;</span></span><br><span class="line"><span class="comment">// import * as a from &#x27;a.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">// a.html</span></span><br><span class="line">&lt;script src=<span class="string">&#x27;b.js&#x27;</span> type=<span class="string">&quot;module&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa</span><br></pre></td></tr></table></figure>

<p>当导入时的变量与该文件中的变量产生冲突时，通过 as 关键字可以在导出文件中替换名字</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="string">&quot;aaa&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">	a <span class="keyword">as</span> a_a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;a_a&#125; <span class="keyword">from</span> <span class="string">&#x27;a.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="string">&quot;bbb&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, a_a)</span><br></pre></td></tr></table></figure>

<p>或者在导入时起别名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="string">&quot;aaa&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">	a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;a <span class="keyword">as</span> a_a&#125; <span class="keyword">from</span> <span class="string">&#x27;a.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="string">&quot;bbb&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, a_a)</span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bbb, aaa</span><br></pre></td></tr></table></figure>

<h3 id="导入导出优化"><a href="#导入导出优化" class="headerlink" title="导入导出优化"></a>导入导出优化</h3><p>当管理多个导入导出文件时，可采用如下优化方式（main.js 中需要引入 utils 文件夹下的所有工具类）。创建index.js 文件导入所有工具方法，并导出，此时 main.js 中只需要引入 index.js 文件中的方法即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- utils</span><br><span class="line">	-- parse.js</span><br><span class="line">	-- time.js</span><br><span class="line">	-- index.js</span><br><span class="line">-- main.js</span><br></pre></td></tr></table></figure>

<p>代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="comment">// 导出所有</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;parse.js&#x27;</span></span><br><span class="line"><span class="comment">// 如下更清晰</span></span><br><span class="line">expor &#123; timeUtils &#125; <span class="keyword">from</span> <span class="string">&#x27;time.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">parseInt</span>, timeUtils &#125; <span class="keyword">from</span> <span class="string">&#x27;utils/index.js&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="默认导出"><a href="#默认导出" class="headerlink" title="默认导出"></a>默认导出</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="comment">// 一个模块中只能存在一个默认导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;default export&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">import</span> aaa <span class="keyword">from</span> <span class="string">&#x27;a.js&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="导入函数"><a href="#导入函数" class="headerlink" title="导入函数"></a>导入函数</h3><p>默认导入只能在文件顶层，浏览器在加载 <code>js</code> 文件时，会直接在文件顶层扫描 import 并下载</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="string">&quot;aaa&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">let</span> flag = <span class="literal">true</span></span><br><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">const</span> importPromise = <span class="keyword">import</span>(<span class="string">&#x27;./a.js&#x27;</span>)</span><br><span class="line">    importPromise.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">a</span>) <span class="comment">// aaa</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// import(&#x27;./a.js&#x27;).then((res) =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(res.a) // aaa</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如下导入方式将会报错，因为在执行之后才能知道具体要导入的文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;a&#125; <span class="keyword">from</span> <span class="string">&#x27;a&#x27;</span> + <span class="string">&#x27;.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;a&#125; <span class="title function_">from</span> (<span class="string">&#x27;a&#x27;</span> + <span class="string">&#x27;.js&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>在 ES11（ES2020） import 中添加了如下的属性：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    url<span class="punctuation">:</span> &#x27;http<span class="punctuation">:</span><span class="comment">//127.0.0.1:5500/a.js&#x27;, // 加载该 js 文件所使用的 url</span></span><br><span class="line">    resolve<span class="punctuation">:</span> ƒ</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="解析流程-TODO"><a href="#解析流程-TODO" class="headerlink" title="解析流程 TODO"></a>解析流程 TODO</h3><h2 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h2><p>当所加载的第三方工具包的入口文件不为 index.js 文件时，无法通过 <code>require(&#39;第三方工具包&#39;)</code> 进行导入，可在第三方工具包中创建 <code>package.json</code> 文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如第三方工具包的入口文件为 main.js</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    name<span class="punctuation">:</span> <span class="string">&quot;第三方工具包&quot;</span><span class="punctuation">,</span></span><br><span class="line">    version<span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    main<span class="punctuation">:</span> <span class="string">&quot;main.js&quot;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="scripts-脚本"><a href="#scripts-脚本" class="headerlink" title="scripts 脚本"></a>scripts 脚本</h3><p>针对于特定名称的脚本可以省略 run 参数，例如：<code>npm start</code> ，可以省略 run 的命令如下：start、test、stop、restart</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    scripts<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="string">&quot;node main.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">        build<span class="punctuation">:</span> <span class="string">&quot;webpack ...&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="开发依赖、生产依赖"><a href="#开发依赖、生产依赖" class="headerlink" title="开发依赖、生产依赖"></a>开发依赖、生产依赖</h3><p>开发依赖：只在开发过程中会使用到，例如：webpack。执行命令：<code>npm install/i xxx --save-dev/-D</code> </p>
<p>生产依赖：在开发过程以及生产过程都会被使用到，例如：vue。执行命令：<code>npm install/i xxx --save/-S</code> </p>
<p>peer 依赖：在依赖本库时需要先安装该依赖的库</p>
<p><em>全局安装命令： <code>npm install xxx -g</code></em> </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    dependencies<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.0&quot;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    devDependencies<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;webpack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.0&quot;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    peerDependencies<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h3><p>semver 版本规范 <code>X.Y.Z</code> </p>
<ul>
<li>X 主版本号（major）：当做了不兼容的 API 修改时（可能不兼容之前的版本）</li>
<li>Y 次版本号（minor）：当做了向下兼容的功能性新增（新功能增加，但兼容以前的版本）</li>
<li>Z 修订号（patch）：当做了向下兼容的问题修正（没有新功能，修复了之前版本的 BUG）</li>
</ul>
<p><code>^</code> 和 <code>~</code> 前缀</p>
<ul>
<li><code>x.y.z</code> 代表特定的版本</li>
<li><code>^x.y.z</code> 代表 x 是保持不变的，y 和 z 永远安装最新的版本</li>
<li><code>~x.y.z</code> 表示 x 和 y 是保持不变的，z永远安装最新的版本</li>
</ul>
<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取缓存目录</span></span><br><span class="line">$ npm config get cache</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取配置信息</span></span><br><span class="line">$ npm config list</span><br><span class="line"><span class="comment"># ; &quot;user&quot; config from ~\.npmrc</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># cache = &quot;~/node-v18.14.0-win-x64/node_cache&quot;</span></span><br><span class="line"><span class="comment"># prefix = &quot;~/node-v18.14.0-win-x64/node_global&quot;</span></span><br><span class="line"><span class="comment"># registry = &quot;http://registry.npm.taobao.org/&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ; node bin location = ~/node-v18.14.0-win-x64/node.exe</span></span><br><span class="line"><span class="comment"># ; node version = v18.14.0</span></span><br><span class="line"><span class="comment"># ; npm local prefix = ~/project</span></span><br><span class="line"><span class="comment"># ; npm version = 9.3.1</span></span><br><span class="line"><span class="comment"># ; cwd = ~/project</span></span><br><span class="line"><span class="comment"># ; HOME = ~</span></span><br><span class="line"><span class="comment"># ; Run `npm config ls -l` to show all defaults.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载某个第三方库</span></span><br><span class="line">$ npm uninstall xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新构建项目依赖</span></span><br><span class="line">$ npm rebuild</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清除缓存</span></span><br><span class="line">$ npm cache clean</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取本地使用的镜像源</span></span><br><span class="line">$ npm config get registry</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新镜像源</span></span><br><span class="line">$ npm config <span class="built_in">set</span> registry <span class="string">&quot;镜像源地址&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录到 npm registry</span></span><br><span class="line">$ npm login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布当前包到 npm registry</span></span><br><span class="line">$ npm publish</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除发布的包</span></span><br><span class="line">$ npm unpublish</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让发布的包过期</span></span><br><span class="line">$ npm deprecate</span><br></pre></td></tr></table></figure>



<h2 id="npx"><a href="#npx" class="headerlink" title="npx"></a>npx</h2><p>当使用 npx 命令执行别的第三方包命令时，将会首先在该目录下的 node_modules 文件夹下的 .bin 文件夹中查找该命令是否存在，存在则会优先执行该命令</p>
<h2 id="pnpm"><a href="#pnpm" class="headerlink" title="pnpm"></a>pnpm</h2><p>每创建一个项目都需要下载对应的第三方工具包，为了解决包占用较大的问题，pnpm采用软链接、硬链接</p>
<ul>
<li>扁平化：当一个工具包依赖另一个工具包时，将会直接下载到 node_modules 文件夹下，导致在<code>package.json</code> 中没有写入依赖项就可以导入。当卸载该工具包时，其依赖包也可能被删除，由此引发导入错误</li>
<li>非扁平化：当一个工具包依赖另一个工具包时，依赖项将会下载到在该工具包中</li>
</ul>
<p><code>pnpm</code> 通过设置软连接的方式将一个工具包依赖的另一个工具包保存到该工具包目录中，安装的该工具包依赖的工具包将会以硬链接的方式存储到 <code>.pnpm</code> 目录下</p>
<h2 id="Webpack-模块化打包工具"><a href="#Webpack-模块化打包工具" class="headerlink" title="Webpack 模块化打包工具"></a>Webpack 模块化打包工具</h2><blockquote>
<p>Webpack 是一个静态的模块化打包工具。打包后成为最终的静态资源，用于部署到服务器中</p>
<p>Webpack 支持 ES Module、CommonJS、AMD 等规范</p>
</blockquote>
<p>对项目进行打包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行当前项目依赖的 webpack 进行打包</span></span><br><span class="line">$ npx webpack</span><br></pre></td></tr></table></figure>

<p>当将该命令集成到 <code>package.json</code> 文件中，则可以省略 <code>npx</code> ，<code>package.json</code> 中的命令将会自动在该项目依赖中进行查找</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    scripts<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>webpack 默认会找到 <code>src/index.js</code> 文件进行打包</p>
<ul>
<li>可以通过参数指定要打包的文件：<code>npx webpack --entry ./src/main.js</code> 进行修改</li>
<li>通过添加如下参数：<code>npx webpack --output-filename bundle.js</code> 修改输出的文件名</li>
<li>通过添加如下参数：<code>npx webpack --output-dir build</code> 修改输出的文件夹名称</li>
</ul>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>通过添加 webpack.config.js 文件修改 webpack 的配置信息。该文件采用 CommonJS 语法规范</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// path 必须指定绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当该配置文件名字不为 webpack.config.js 时可使用 <code>npx webpack --config newname.config.js</code> 来指定</p>
<p>为了简化命令可以使用 <code>package.json</code> 的 scripts ：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">    scripts<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --config newname.config.js&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置后缀名"><a href="#配置后缀名" class="headerlink" title="配置后缀名"></a>配置后缀名</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// path 必须指定绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.jsx&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>] <span class="comment">// 配置可省略的后缀名</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="打包模式"><a href="#打包模式" class="headerlink" title="打包模式"></a>打包模式</h3><p>可选择的打包方式为：none | development | production（默认）</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>development</td>
<td>会将 DefinePlugin 中的 process.env.NODE_ENV 的值设置为 development，为模块和 chunk 启用有效的名</td>
</tr>
<tr>
<td>production</td>
<td>会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 production，为模块和 chunk 启用确定新的混淆名称，FlagDependencyUsagePlugin、FlagIncludeChunksPlugin、ModuleConcatenationPlugin、NoEmitOnErrorsPlugin 和 TerserPligin</td>
</tr>
<tr>
<td>none</td>
<td>不适用任何默认优化选项</td>
</tr>
</tbody></table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>, <span class="comment">// none | development | production (default)</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// path 必须指定绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="HTML-webpack-plugin"><a href="#HTML-webpack-plugin" class="headerlink" title="HTML webpack plugin"></a>HTML webpack plugin</h3><p>将 html 文件打包生成到指定的文件夹中</p>
<p>安装指定插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>使用指定插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="对-React-代码进行打包"><a href="#对-React-代码进行打包" class="headerlink" title="对 React 代码进行打包"></a>对 React 代码进行打包</h3><p>安装 react 依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react react-dom</span><br></pre></td></tr></table></figure>

<p>安装对应编译 jsx 代码的插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/plugin-systax-jsx -D</span><br><span class="line">npm install @babel/plugin-transform-react-jsx -D</span><br><span class="line">npm install @babel/plugin-transform-react-display-name -D</span><br><span class="line"></span><br><span class="line">// 或者直接安装预设</span><br><span class="line"></span><br><span class="line">npm install @babel/preset-react -D</span><br></pre></td></tr></table></figure>

<p>App 组件中的 jsx 代码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; memo, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Component</span> = <span class="title function_">memo</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Count: &#123;count&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Component</span></span><br></pre></td></tr></table></figure>

<p>main 入口文件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDom</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.jsx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDom</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>))</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>)</span><br></pre></td></tr></table></figure>

<p>babel.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">corejs</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">useBuiltIns</span>: <span class="string">&#x27;entry&#x27;</span> <span class="comment">// 表示不使用 polyfill，可选值：【false|usage(使用polyfill进行填充)|entry】</span></span><br><span class="line">    &#125;],</span><br><span class="line">    [<span class="string">&#x27;@babel/preset-react&#x27;</span>], <span class="comment">// 解析 react 代码</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="对-TS-文件进行打包"><a href="#对-TS-文件进行打包" class="headerlink" title="对 TS 文件进行打包"></a>对 TS 文件进行打包</h3><ol>
<li><p>可以使用 typescript compiler 进行打包，通过 tsc file.ts 进行手动打包</p>
</li>
<li><p>通过使用 ts-loader 进行整合 webpack 进行打包</p>
<p>需要对应的 tsconfig.json 文件（可以通过 npx tsc -init 生成）</p>
<p>会对 类型检查错误的代码进行报错</p>
<p>打包的内容并不包括 polyfill 部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.jsx&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&#x27;ts-loader&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>通过 ts 预设进行打包：@babel&#x2F;preset-typescript（推荐）</p>
<p>但是 使用 babel-loader 将不会对 ts 代码类型检查错误进行报错</p>
<p>此时会使用 polyfill 进行填充</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>, <span class="comment">// 不会对类型检查错误进行报错</span></span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-typescript&#x27;</span>]</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// loader: &#x27;ts-loader&#x27; // 会对类型检查错误进行报错</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在使用过程中既要类型检查抛出异常又要使用 polyfill 进行代码的填充，可以通过配置 package.json 脚本</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tsc --noEmit &amp;&amp; webpack&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>noEmit 表示不输出任何东西，也即不进行转换</p>
</li>
</ol>
<h3 id="Source-Map"><a href="#Source-Map" class="headerlink" title="Source Map"></a>Source Map</h3><p>webapck 配置文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>, <span class="comment">// none | development | production (default)</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>, <span class="comment">// reflect to the source code, will generate the filename.js.map file, if the mode is development then the devtool is source-map</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// path 必须指定绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写的主文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span><br><span class="line"></span><br><span class="line">name = <span class="number">123</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span><br></pre></td></tr></table></figure>

<p>最后一行的注释指明了该打包后的文件的 source map 文件</p>
<p>浏览器会根据我们的注释，查找相应的 source-map，并且根据  source-map 还原我们的代码，方便进行调试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">()=&gt;</span>&#123;<span class="keyword">let</span> o=<span class="string">&quot;abc&quot;</span>;<span class="variable language_">console</span>.<span class="title function_">log</span>(o),o=<span class="number">123</span>,<span class="variable language_">console</span>.<span class="title function_">log</span>(o)&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br></pre></td></tr></table></figure>

<p>生成的 source-map 文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="comment">// 当前使用的版本，也就是最新的第三版</span></span><br><span class="line">  <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bundle.js&quot;</span><span class="punctuation">,</span> <span class="comment">// 打包后的文件（浏览器加载的文件）</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MAAA,IAAIA,EAAO,MAEXC,QAAQC,IAAIF,GAEZA,EAAO,IAEPC,QAAQC,IAAIF,E&quot;</span><span class="punctuation">,</span> <span class="comment">// source-map 用来和源文件映射的信息（比如位置信息等），一串 base64 VLQ（variable length quantity，可变长度值）编码</span></span><br><span class="line">  <span class="attr">&quot;sources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;webpack://webpack/./src/main.js&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 从哪些文件转换过来的 source-map 和打包的代码（最初始的文件）</span></span><br><span class="line">  <span class="attr">&quot;sourcesContent&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;let name = &#x27;abc&#x27;\r\n\r\nconsole.log(name)\r\n\r\nname = 123\r\n\r\nconsole.log(name)\r\n&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 转换前的具体代码信息（和 sources 是对应的关系）</span></span><br><span class="line">  <span class="attr">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;console&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 转换前的变量和属性名称（因为我们目前使用的是 development 模式，所以不需要保留转换前的名称）</span></span><br><span class="line">  <span class="attr">&quot;sourceRoot&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span> <span class="comment">// 所有的 sources 相对的根目录</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="devtool-选项"><a href="#devtool-选项" class="headerlink" title="devtool 选项"></a>devtool 选项</h3><ul>
<li><p>false：不使用 source-map，也就是没有任何和 source-map 相关的内容</p>
</li>
<li><p>none：production 模式下的默认值（什么值都不写），不生成 source-map</p>
</li>
<li><p>eval：development 模式下的默认值，不生成  source-map</p>
<ul>
<li>但是他会在 eval 执行的代码中，添加 &#x2F;&#x2F; # sourceURL&#x3D;;</li>
<li>它会被浏览器在执行时解析，并且在调试面板中生成对应的一些文件目录，方便我们调试（但是此时还原的代码并不一定准确到具体的行、列）速度快</li>
</ul>
</li>
<li><p>source-map：会生成完整的 source-map 文件，一般设置在 production 模式下</p>
</li>
<li><p>eval-source-map：会生成 sourcemap，但是 source-map 是以 DateUrl 添加到 eval 函数的后面（将 source-map 文件内容<strong>转化为 base64 放到 eval 函数的后面</strong>）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(... <span class="comment">//# sourceMappingURL=data;application/json;charset=utf-8;base64,)</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>inline-source-map：会生成 sourcemap，但是 source-map 是以 DateUrl 添加到 bundle 文件的后面（将 source-map 文件内容<strong>转化为 base64 放到 bundle 文件的最后面</strong>）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(... )</span><br><span class="line"><span class="comment">//# sourceMappingURL=data;application/json;charset=utf-8;base64,</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>cheap-source-map</p>
<ul>
<li>会生成 sourcemap，但是会更加高效一些（cheap 低开销），因为 <strong>他没有生成列映射</strong> （Column Mapping）</li>
<li>因为再发开中，我们只需要行信息通常就可以定位到错误了</li>
<li>在 development 中才会生成相应的 .js.map 文件</li>
</ul>
</li>
<li><p>cheap-module-source-map</p>
<ul>
<li>会生成 sourcemap，类似于 cheap-source-map，但是对源自 loader 的 sourcemap 处理会更好</li>
<li>如果 loader 对我们的源代码进行了特俗的处理，比如 babel 可能会删掉空行</li>
</ul>
</li>
<li><p>hidden-source-map</p>
<ul>
<li>会生成 sourcemap，但是不会对 sourcemap 文件进行引用</li>
<li>相当于删除了打包文件中对 sourcemap 的引用注释。如果我们手动添加进行，那么 sourcemap 就会生效了</li>
</ul>
</li>
<li><p>nosources-source-map</p>
<ul>
<li>会生成 sourcemap，但是生成的 sourcemap 只有错误信息的提示，不会生成源代码文件</li>
</ul>
</li>
</ul>
<h3 id="配置插件"><a href="#配置插件" class="headerlink" title="配置插件"></a>配置插件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>, <span class="comment">// none | development | production (default)</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>, <span class="comment">// reflect to the source code, will generate the filename.js.map file, if the mode is development then the devtool is source-map</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// path 必须指定绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// when rebuild, the output dir will be cleaned</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [], <span class="comment">// add plugins</span></span><br><span class="line">            <span class="attr">presets</span>: [</span><br><span class="line">              <span class="string">&#x27;@babel/preset-env&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自动化编译"><a href="#自动化编译" class="headerlink" title="自动化编译"></a>自动化编译</h3><p>通过如下方式可以达到自动编译</p>
<ol>
<li>webpack watch mode</li>
<li>webpack-dev-server （常用）<ul>
<li>webpack-dev-server 使用了 memfs 库，不会输出任何文件，生成的中间结果在内存中</li>
</ul>
</li>
<li>webpack-dev-middleware</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server -D</span><br></pre></td></tr></table></figure>

<p>配置 DevServer</p>
<p>如果配置了 devServer.static 那么该内容会覆盖默认值，也即如果这个地方没有写 public 那么 public 将不会被认为是静态资源目录</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// if this is defined, then the public must be insert to this list</span></span><br><span class="line">    <span class="attr">static</span>: [<span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;temp&#x27;</span>],</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>, <span class="comment">// 进行压缩，会设置响应头中 content-encoding: gzip    </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Webpack-性能优化"><a href="#Webpack-性能优化" class="headerlink" title="Webpack 性能优化"></a>Webpack 性能优化</h3><ul>
<li>对打包结果进行优化<ul>
<li>分包处理，Vue&#x2F;React 路由懒加载</li>
<li>代码进行压缩（丑化 const message &#x3D;&gt; const m）</li>
<li>删除无用代码（tree shaking）</li>
<li>CDN 服务器（对第三方库使用 CDN）</li>
</ul>
</li>
<li>对打包过程进行优化<ul>
<li>加速打包的过程（exclude&#x2F;cache-loader）</li>
</ul>
</li>
</ul>
<h4 id="1-分包处理"><a href="#1-分包处理" class="headerlink" title="1. 分包处理"></a>1. 分包处理</h4><ul>
<li>他的主要目的是将 <strong>代码分离到不同的 bundle 中</strong>，之后我们可以 <strong>按需加载</strong>，或者并行加载这些文件</li>
<li>默认情况下，所有的 JavaScript 代码（业务代码、第三方依赖、暂时没有用到的模块）在首页全部都加载，会影响首页加载的速度</li>
<li>代码可以分离出更小的 bundle，以及控制资源加载优先级，提供代码的性能。</li>
</ul>
<p>webapck 中常用的代码分离方式：</p>
<ol>
<li><p>入口起点：使用 entry 配置手动分离代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">index</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&#x27;./src/main.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 使用占位符：name 为上面的 index 和 main</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name]-bundle.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// path 必须指定绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// when rebuild, the output dir will be cleaned</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当多个入口文件对同一个库进行了依赖，可以设置起共享的库</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">index</span>: &#123;</span><br><span class="line">      <span class="attr">import</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">      <span class="attr">dependOn</span>: <span class="string">&#x27;shared1&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">main</span>: &#123;</span><br><span class="line">      <span class="attr">import</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">      <span class="attr">dependOn</span>: <span class="string">&#x27;shared1&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// shared 可以配置多个，将会输出到 shared-xxx 文件中，其他依赖将会对该包进行引入 </span></span><br><span class="line">    <span class="attr">shared1</span>: [<span class="string">&#x27;react&#x27;</span>, <span class="string">&#x27;react-dom&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 使用占位符：name 为上面的 index 和 main</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name]-bundle.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// path 必须指定绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// when rebuild, the output dir will be cleaned</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>防止重复：使用 Entry Dependencies 或 SplitChunksPlugin 去重和分离代码</p>
</li>
<li><p>动态导入：通过模块的内联函数调用来分离代码</p>
<p>通过使用 import 函数 <code>import(&#39;xxx.js&#39;).then(() =&gt; &#123;&#123;&#125;&#125;)</code> </p>
<p>当使用 import 函数时，then 中可以直接拿到导入文件的 export 对象，获取导出 default 对象，可以通过 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;xxx.js&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取默认导出对象</span></span><br><span class="line">  res.<span class="title function_">default</span>()</span><br><span class="line">  <span class="comment">// 获取导出对象</span></span><br><span class="line">  res.<span class="property">obj</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>通过魔法注释修改打包后的文件名：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a 代表打包后的文件名，此名称替换 name 字段</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &#x27;a&#x27; */</span><span class="string">&#x27;./ts/a&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">getResult</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getResult</span>(<span class="string">&#x27;$123&#x27;</span>))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getResult</span>(<span class="string">&#x27;234&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>webpack 配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name]-bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&#x27;[name]_chunk.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// chunkFilename: &#x27;[id]_[name]_chunk.js&#x27;, // id 为文件路径，文件名使用 _ 分割的字符串</span></span><br><span class="line">    <span class="comment">// path 必须指定绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// when rebuild, the output dir will be cleaned</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过配置 webpack 优化选项，设置分包方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="comment">// natural: 按照数字的顺序使用 id</span></span><br><span class="line">    <span class="comment">// named: development 下的默认值，文件路径使用 _ 分割</span></span><br><span class="line">    <span class="comment">// deterministic: 确定的，在不同的编译中不变的短数字 id</span></span><br><span class="line">    <span class="attr">chunkIds</span>: <span class="string">&#x27;deterministic&#x27;</span>,</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>, <span class="comment">// default：async</span></span><br><span class="line">      <span class="attr">maxSize</span>: <span class="number">20000</span>, <span class="comment">// 20kb 拆分后的包最大大小，可能会大于最大值，由于一个函数或类可能很大</span></span><br><span class="line">      <span class="attr">minSize</span>: <span class="number">10</span>, <span class="comment">// 拆分后的包最小大小</span></span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123; <span class="comment">// 自定义拆包</span></span><br><span class="line">        <span class="attr">vendors</span>: &#123;</span><br><span class="line">          <span class="comment">// test: /node_modules/, // 匹配路径中包含该字符串的</span></span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>, <span class="comment">// 匹配路径中包含 /node_modules/ 或者 \node_modules\</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&#x27;[name]_vendors.js&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">utils</span>: &#123; <span class="comment">// 当编写的文件小于 minSize 时将不会被拆分</span></span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/utils/</span>,</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&#x27;[name]_utils.js&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>chunIds 将会指定打包后文件的名字，当设置 natural 时，当导入文件发生变化时，不利于浏览器缓存，导致重新加载</p>
<ul>
<li>在开发中，推荐使用 named</li>
<li>在打包过程中，推荐使用 deterministic</li>
</ul>
<h3 id="Prefetch-和-Preload"><a href="#Prefetch-和-Preload" class="headerlink" title="Prefetch 和 Preload"></a>Prefetch 和 Preload</h3><p>在声明 import 时，使用内置指令，告知浏览器</p>
<ul>
<li>prefetch（预获取）：将来某些导航下可能需要的资源</li>
<li>preload（预加载）：当前导航下可能需要的资源</li>
</ul>
<p>于 prefetch 指令相比，preload 指令由许多不同之处</p>
<ul>
<li>preload chunk 会在父 chunk 加载时，以并行方式开始加载，prefetch 会在父 chunk 加载结束后开始加载</li>
<li>preload chunk 具有中等优先级，并立即下载。prefetch chunk 在浏览器闲置时下载</li>
<li>preload chunk 会在父 chunk 中立即请求，用于当下时刻。prefetch chunk 会用于未来的某个时刻</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(</span><br><span class="line">  <span class="comment">/* webpackChunkName: &#x27;a&#x27; */</span></span><br><span class="line">  <span class="comment">/* webpackPreload: true */</span> <span class="comment">// 设置预加载</span></span><br><span class="line">  <span class="string">&#x27;./ts/a&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">getResult</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getResult</span>(<span class="string">&#x27;$123&#x27;</span>))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getResult</span>(<span class="string">&#x27;234&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="Shimming"><a href="#Shimming" class="headerlink" title="Shimming"></a>Shimming</h3><p>shimming 是一个概念，是某一类功能的统称：</p>
<ul>
<li>shimming 翻译过来我们称之为 垫片，相当于给我们的代码填充一些垫片来处理一些问题</li>
<li>比如我们现在以来一个第三方的库，这个第三方的库本身依赖 lodash，但是默认没有对 lodash 进行导入（认为全局存在 lodash），那么我们就可以通过 ProvidePlugin 来实现 shimming 的效果</li>
</ul>
<p>webpack 并不推荐随意的使用 shimming</p>
<ul>
<li>webpack 背后的整个理念是使前端开发更加模块化</li>
<li>也就是说，需要编写具有封闭性的，不存在隐含依赖（比如全局变量）的彼此隔离的模块</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ProvidePlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 相当于对全局使用 import ReactDom from &#x27;react-dom/client&#x27;</span></span><br><span class="line">      <span class="comment">// ReactDom: &#x27;react-dom/client&#x27;,</span></span><br><span class="line">      <span class="comment">// 相当于对全局使用 import &#123; createRoot &#125; from &#x27;react-dom/client</span></span><br><span class="line">      <span class="attr">createRoot</span>: [<span class="string">&#x27;react-dom/client&#x27;</span>, <span class="string">&#x27;createRoot&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="对-CSS-文件进行单独提取"><a href="#对-CSS-文件进行单独提取" class="headerlink" title="对 CSS 文件进行单独提取"></a>对 CSS 文件进行单独提取</h3><p>提取 css 需要安装对应的依赖：<code>npm install mini-css-extract-plugin -D</code> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="comment">// &#x27;style-loader&#x27;, // style-loader 将会通过 js 在 html 插入 style 标签，并将相应的样式填入（开发阶段）</span></span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="comment">// 提取到单独的 css 文件中，通过 link 进行引入（生产阶段）</span></span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">        ], <span class="comment">// loader 将会从后往前进行加载</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./index.html&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 对打包后的文件名字，如下打包将会放入 css 文件夹中</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;css/[name]-css.css&#x27;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&#x27;css/[name].css&#x27;</span>, <span class="comment">// 分包后的包文件名</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Hash、ContentHash、ChunkHash"><a href="#Hash、ContentHash、ChunkHash" class="headerlink" title="Hash、ContentHash、ChunkHash"></a>Hash、ContentHash、ChunkHash</h3><p>在给打包的文件进行命名的时候，会使用 placeholder，placeholder 中有几个比较常用的属性</p>
<p>hash 本身使通过 MD4 的散列函数处理后，生成一个 128 位的 hash 值（32 个十六进制）</p>
<ul>
<li>fullhash：当某个文件发生改变时，所有文件的 hash 值都会重新生成，且一样<ul>
<li>hash 值的生成和整个项目有关系</li>
<li>当存在两个入口文件 index.js 和 main.js 时，他们分别会输出到不同的 bundle.js 文件中，并且在文件名称中我们有使用 hash</li>
<li>这个时候，如果修改了 index.js 文件中的内容，那么 hash 会发生变化，意味着两个文件的名称都会发生变化</li>
</ul>
</li>
<li>chunkhash：当某个文件发生改变时，只有改变的文件 hash 值会重新生成<ul>
<li>可以有效解决上面的问题，他会根据不同的入口进行解析来生成 hash 值</li>
<li>比如修改了 index.js，那么 main.js 的 chunkhash 是不会发生改变的</li>
<li>chunkhash 根据不同的入口文件(entry)进行依赖文件解析、构建对应的chunk，生成对应的哈希值。当某个文件内容发生变动时，再次执行打包，只有该文件以及依赖该文件的文件的打包结果 hash 值会发生改变</li>
</ul>
</li>
<li>contenthash：表示生成的文件 hash 名称，只和内容有关（推荐）<ul>
<li>比如我们的 index.js 引入了一个 style.css，style.css 有被抽取到一个独立的 css 文件</li>
<li>这个 css 文件在命名时，如果我们使用的是 chunkhash，那么当 index.js 文件的内容发生变化时，css 文件的命名也会发生变化</li>
<li>这个时候我们可以使用 contenthash</li>
</ul>
</li>
</ul>
<h3 id="DLL-库"><a href="#DLL-库" class="headerlink" title="DLL 库"></a>DLL 库</h3><p>DLL 全程是动态链接库（Dynamic Link Library）</p>
<ul>
<li>它指的是我们可以共享，并且不经常改变的代码，抽取称一个共享的库</li>
<li>这个库在之后编译的过程中，会被引入到其他项目的代码中</li>
</ul>
<p>使用过程：</p>
<ol>
<li>打包 DLL 库</li>
<li>项目中引入 DLL 库</li>
</ol>
<p>现在已经不再使用，移除原因：webpack 4 已经提供很好的性能，没有必要再花费时间去维护 DLL</p>
<h3 id="Terser"><a href="#Terser" class="headerlink" title="Terser"></a>Terser</h3><ul>
<li><p>Terser 是一个 JavaScript 的解析（Parser）、Mangler（绞肉机）、Compressor（压缩机） 的工具集</p>
</li>
<li><p>早期我们会使用 uglify-js 来压缩、丑化我们的 JavaScript 代码，但是目前已经不再维护，并且不支持 ES6+ 的语法</p>
</li>
<li><p>Terser 是从 uglify-es fork 过来的，并且保留了他原来的大部分 API 以及适配 uglify-es 和 uglify-js@3 等</p>
</li>
</ul>
<h4 id="命令行使用方式"><a href="#命令行使用方式" class="headerlink" title="命令行使用方式"></a>命令行使用方式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terser [filename] -o [outputfilename] -c [arguments] -m [arguments]</span><br></pre></td></tr></table></figure>

<p>-c 表示压缩（compress）</p>
<ul>
<li>arrows：class 或 object 中的函数，转换成箭头函数</li>
<li>arguments：将函数中使用的 arguments[index] 转成对应的形参名称</li>
<li>dead_code：移除不可达的代码（tree shaking）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx terser a.js -o a.min.js -c arrows=<span class="literal">true</span>,arguments=<span class="literal">true</span>,dead_code=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>优化前代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">name1, name2</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name1, name2)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>[<span class="number">0</span>], <span class="variable language_">arguments</span>[<span class="number">1</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;234&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  name = <span class="string">&#x27;zhangsan&#x27;</span></span><br><span class="line">  <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;lisi&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优化后代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">name1,name2</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(name1,name2),<span class="variable language_">console</span>.<span class="title function_">log</span>(name1,name2)&#125;<span class="title function_">test</span>(<span class="string">&quot;123&quot;</span>,<span class="string">&quot;234&quot;</span>);<span class="keyword">const</span> obj=&#123;<span class="attr">bar</span>:<span class="function">()=&gt;</span><span class="string">&quot;bar&quot;</span>&#125;;<span class="keyword">class</span> <span class="title class_">Person</span>&#123;name=<span class="string">&quot;zhangsan&quot;</span>;<span class="title function_">getName</span>(<span class="params"></span>)&#123;<span class="keyword">return</span><span class="string">&quot;lisi&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>-m 选项</p>
<ul>
<li><p>top_level：优化顶层所有变量名</p>
</li>
<li><p>keep_fnames：保持函数原名</p>
</li>
<li><p>keep_classnames：保持原类名</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx terser .\src\main.js -o main.min.js -c arrows=<span class="literal">true</span>,arguments=<span class="literal">true</span>,dead_code=<span class="literal">true</span> -m toplevel=<span class="literal">true</span>,keep_fnames=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>优化后代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">n,s</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(n,s),<span class="variable language_">console</span>.<span class="title function_">log</span>(n,s)&#125;<span class="title function_">test</span>(<span class="string">&quot;123&quot;</span>,<span class="string">&quot;234&quot;</span>);<span class="keyword">const</span> n=&#123;<span class="attr">bar</span>:<span class="function">()=&gt;</span><span class="string">&quot;bar&quot;</span>&#125;;<span class="keyword">class</span> <span class="title class_">s</span>&#123;name=<span class="string">&quot;zhangsan&quot;</span>;<span class="title function_">getName</span>(<span class="params"></span>)&#123;<span class="keyword">return</span><span class="string">&quot;lisi&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="在-webpack-中配置-terser"><a href="#在-webpack-中配置-terser" class="headerlink" title="在 webpack 中配置 terser"></a>在 webpack 中配置 terser</h4><ul>
<li>在 webpack 中有一个 minimizer 属性，在 production 模式下，默认就是使用 TerserPlugin 来处理我们的代码的</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;js/[contenthash:10]-[name].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="comment">// 屏蔽第三方库中的注释</span></span><br><span class="line">        <span class="attr">extractComments</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// 使用多进程并发提高构建速度，默认值是 true</span></span><br><span class="line">        <span class="comment">// 并发运行的默认数量是 os.cpu().length - 1</span></span><br><span class="line">        <span class="comment">// 我们也可以设置自己的个数，使用默认即可</span></span><br><span class="line">        <span class="attr">parallel</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">          <span class="attr">compress</span>: &#123;</span><br><span class="line">            <span class="comment">// 配置函数中使用 arguments 进行优化</span></span><br><span class="line">            <span class="attr">arguments</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// 未被引用的代码将被删除</span></span><br><span class="line">            <span class="attr">unused</span>: <span class="literal">true</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// 配置 Mangler（绞肉机）</span></span><br><span class="line">          <span class="attr">mangle</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 对 mangle 传入的参数</span></span><br><span class="line">          <span class="attr">keep_fnames</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.css&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="CSS-压缩"><a href="#CSS-压缩" class="headerlink" title="CSS 压缩"></a>CSS 压缩</h3><p>需要安装对应的插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install css-minimizer-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<ul>
<li>css 压缩通常是去除无用的空格等，它使用的是 cssnano 工具来进行优化、压缩 CSS 也可以单独使用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CSSMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;js/[contenthash:10]-[name].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CSSMinimizerPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.css&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./index.html&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;style/[name]-[contenthash:10].css&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="webpack-配置文件的拆分"><a href="#webpack-配置文件的拆分" class="headerlink" title="webpack 配置文件的拆分"></a>webpack 配置文件的拆分</h3><p>在编写 webpack 配置文件时，可以导出一个函数，并且可以通过 –env 给该函数传入相应的参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name]-[contenthash:10].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../build&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">env</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (env.<span class="property">production</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;production environment&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;development environment&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> commonConfig</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;multiply_config&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;src/main.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --config ./config/common.config.js --env development&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;^5.97.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^6.0.1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 webpack-merge 插件进行拆分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HTMLWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> production = <span class="built_in">require</span>(<span class="string">&#x27;./production.config&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> development = <span class="built_in">require</span>(<span class="string">&#x27;./development.config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;js/[name]-[contenthash:10].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../build&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.css&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HTMLWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">env</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (env.<span class="property">production</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;production environment&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(commonConfig, production)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;development environment&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(commonConfig, development)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// development.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// production.config.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCSSExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CSSMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">          <span class="attr">compress</span>: &#123;</span><br><span class="line">            <span class="attr">arrows</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">arguments</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">mangle</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">toplevel</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">keep_fnames</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">keep_classnames</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CSSMinimizerPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="title class_">MiniCSSExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCSSExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;css/[name]-[contenthash:10].css&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="TreeShaking"><a href="#TreeShaking" class="headerlink" title="TreeShaking"></a>TreeShaking</h3><p>通过使用 <code>optimization.userdExports: true</code> 联合 terser 进行删除不会使用的代码</p>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 使用该参数，将会在生成的代码中标注那些函数没被使用</span></span><br><span class="line">    <span class="comment">// 通过 terser plugin 对标记的代码进行删除</span></span><br><span class="line">    <span class="comment">// plugin 模式下会自动开启该功能</span></span><br><span class="line">    <span class="attr">usedExports</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">          <span class="attr">compress</span>: &#123;</span><br><span class="line">            <span class="attr">arrows</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">arguments</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">mangle</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">toplevel</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">keep_fnames</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">keep_classnames</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过 sideEffects 方式删除多余代码在 package.json 中</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;multiply_config&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 告诉 webpack 所有文件都没有副作用，可以删除</span></span><br><span class="line">  <span class="comment">// &quot;sideEffects&quot;: false,</span></span><br><span class="line">  <span class="comment">// 通过数组的方式告诉 webpack 那些文件存在副作用</span></span><br><span class="line">  <span class="attr">&quot;sideEffects&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;./src/utils/sideEffect.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;*.css&quot;</span> <span class="comment">// 所有 css 将不会被优化删除</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/main.js&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在模块中使用类似 <code>window.a = &#39;123&#39;</code> 就时副作用代码</p>
<h4 id="CSS-tree-shaking"><a href="#CSS-tree-shaking" class="headerlink" title="CSS tree shaking"></a>CSS tree shaking</h4><p>安装对应依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install purgecss-webpack-plugin -D</span><br></pre></td></tr></table></figure>



<h3 id="Scope-Hosting"><a href="#Scope-Hosting" class="headerlink" title="Scope Hosting"></a>Scope Hosting</h3><p>由于打包之后的文件每个模块会存在一个单独的作用域，在一个模块中使用另一个模块中的函数等将会涉及跨作用域的问题，从而导致的性能低下。</p>
<p>该配置在 production 模式下是默认开启的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="property">optimize</span>.<span class="title class_">ModuleConcatenationPlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="HTTP-压缩"><a href="#HTTP-压缩" class="headerlink" title="HTTP 压缩"></a>HTTP 压缩</h3><p>HTTP 压缩是一种内置在服务器和客户端之间的，以改进传输速度和带宽利用率的方式</p>
<ol>
<li><p>第一步，http 数据在服务器发送前就已经被压缩了；（可以在 webpack 中完成）</p>
</li>
<li><p>第二步，兼容的浏览器在向服务器发送请求时，或告知服务器自己支持哪些压缩格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/encrypted-area</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.example.com</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三步，服务器在浏览器支持的压缩格式下，直接返回对应的压缩后的文件，并且在响应头中告知浏览器</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Encoding</span><span class="punctuation">: </span>gzip</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Gzip-压缩"><a href="#Gzip-压缩" class="headerlink" title="Gzip 压缩"></a>Gzip 压缩</h3><p>webpack 中相当于是实现了 HTTP 压缩的第一步操作，我们可以使用 CompressionPlugin</p>
<ul>
<li><p>安装 CompressionPlugin</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install compression-webpack-plugin -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 CompressionPlugin</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CompressionPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;compression-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CompressionPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(css|js)$/</span>, <span class="comment">// 匹配哪些文件将被压缩</span></span><br><span class="line">      <span class="comment">// threshold: 500, // 设置文件从多大开始压缩</span></span><br><span class="line">      <span class="attr">minRatio</span>: <span class="number">0.7</span>, <span class="comment">// 至少压缩的比例</span></span><br><span class="line">      <span class="attr">algorithm</span>: <span class="string">&#x27;gzip&#x27;</span> <span class="comment">// 采用的压缩算法</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="HTML-压缩"><a href="#HTML-压缩" class="headerlink" title="HTML 压缩"></a>HTML 压缩</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HTMLWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> production = <span class="built_in">require</span>(<span class="string">&#x27;./production.config&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> development = <span class="built_in">require</span>(<span class="string">&#x27;./development.config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="keyword">function</span>(<span class="params">isProduction</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">      <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;js/[name]-[contenthash:10].js&#x27;</span>,</span><br><span class="line">      <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../build&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">      <span class="attr">extensions</span>: [<span class="string">&#x27;.css&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">HTMLWebpackPlugin</span>(&#123;</span><br><span class="line">        <span class="comment">// 当文件内容发生改变的时候才重新生成</span></span><br><span class="line">        <span class="attr">cache</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">minify</span>: isProduction ? &#123;</span><br><span class="line">          <span class="comment">// 压缩时移除注释</span></span><br><span class="line">          <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 删除空属性，例如 &lt;div class=&#x27;&#x27;&gt;&lt;/div&gt; =&gt; &lt;div&gt;&lt;/div&gt;</span></span><br><span class="line">          <span class="attr">removeEmptyAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 移除多以的属性，例如：&lt;input type=&#x27;text&#x27;&gt; =&gt; &lt;input&gt;</span></span><br><span class="line">          <span class="attr">removeRedundantAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 删除空行和空格</span></span><br><span class="line">          <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 压缩内联 css</span></span><br><span class="line">          <span class="attr">minifyCSS</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 压缩内联 js</span></span><br><span class="line">          <span class="attr">minifyJS</span>: &#123;</span><br><span class="line">            <span class="attr">mangle</span>: &#123;</span><br><span class="line">              <span class="attr">toplevel</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125; : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">template</span>: <span class="string">&#x27;./index.html&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">env</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (env.<span class="property">production</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;production environment&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(<span class="title function_">commonConfig</span>(<span class="literal">true</span>), production)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;development environment&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(<span class="title function_">commonConfig</span>(<span class="literal">false</span>), development)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="针对于打包过程进行分析"><a href="#针对于打包过程进行分析" class="headerlink" title="针对于打包过程进行分析"></a>针对于打包过程进行分析</h3><p>需要安装 speed-measure-webpack-plugin</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install speed-measure-webpack-plugin -D</span><br></pre></td></tr></table></figure>



<h3 id="对打包后的文件进行分析"><a href="#对打包后的文件进行分析" class="headerlink" title="对打包后的文件进行分析"></a>对打包后的文件进行分析</h3><p>方式一：添加 <code>--profile --json=stats.json</code> 将会生成 stats.json 文件，该文件可通过 webpack 的在线分析平台进行分析</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --config ./config/common.config.js --env development --profile --json=stats.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build:pro&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --config ./config/common.config.js --env production&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>方式二：使用插件进行分析打包后的文件 <code>webpack-bundle-analyzer</code> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-bundle-analyzer -D</span><br></pre></td></tr></table></figure>

<p>在 webpack 中配置该插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BundleAnalyzerPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-bundle-analyzer&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">BundleAnalyzerPlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该方式会自动开启一个端口用于展示生成后的文件状态：localhost:8080 </p>
<h2 id="Webpack-源码"><a href="#Webpack-源码" class="headerlink" title="Webpack 源码"></a>Webpack 源码</h2><h3 id="createCompiler"><a href="#createCompiler" class="headerlink" title="createCompiler"></a>createCompiler</h3><p>webpack 首先会创建 compiler，然后注册插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">WebpackOptions</span>&#125; rawOptions options object</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; [compilerIndex] index of compiler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Compiler</span>&#125; a compiler</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createCompiler</span> = (<span class="params">rawOptions, compilerIndex</span>) =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> options = <span class="title function_">getNormalizedWebpackOptions</span>(rawOptions);</span><br><span class="line">	<span class="title function_">applyWebpackOptionsBaseDefaults</span>(options);</span><br><span class="line">	<span class="keyword">const</span> compiler = <span class="keyword">new</span> <span class="title class_">Compiler</span>(</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">string</span>&#125; */</span> (options.<span class="property">context</span>),</span><br><span class="line">		options</span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">NodeEnvironmentPlugin</span>(&#123;</span><br><span class="line">		<span class="attr">infrastructureLogging</span>: options.<span class="property">infrastructureLogging</span></span><br><span class="line">	&#125;).<span class="title function_">apply</span>(compiler);</span><br><span class="line">	<span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(options.<span class="property">plugins</span>)) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">const</span> plugin <span class="keyword">of</span> options.<span class="property">plugins</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">typeof</span> plugin === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">				<span class="comment">// 当插件是一个函数时将会执行这个函数，传入 compiler，并给该函数绑定 compiler</span></span><br><span class="line">				<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">WebpackPluginFunction</span>&#125; */</span></span><br><span class="line">				(plugin).<span class="title function_">call</span>(compiler, compiler);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (plugin) &#123;</span><br><span class="line">				<span class="comment">// 当插件时一个对象时，必须存在一个 apply 函数，compiler 将会传入这个函数</span></span><br><span class="line">				plugin.<span class="title function_">apply</span>(compiler);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">const</span> resolvedDefaultOptions = <span class="title function_">applyWebpackOptionsDefaults</span>(</span><br><span class="line">		options,</span><br><span class="line">		compilerIndex</span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">if</span> (resolvedDefaultOptions.<span class="property">platform</span>) &#123;</span><br><span class="line">		compiler.<span class="property">platform</span> = resolvedDefaultOptions.<span class="property">platform</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	compiler.<span class="property">hooks</span>.<span class="property">environment</span>.<span class="title function_">call</span>();</span><br><span class="line">	compiler.<span class="property">hooks</span>.<span class="property">afterEnvironment</span>.<span class="title function_">call</span>();</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">WebpackOptionsApply</span>().<span class="title function_">process</span>(options, compiler);</span><br><span class="line">	compiler.<span class="property">hooks</span>.<span class="property">initialize</span>.<span class="title function_">call</span>();</span><br><span class="line">	<span class="keyword">return</span> compiler;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<h3 id="webpack-解析过程"><a href="#webpack-解析过程" class="headerlink" title="webpack 解析过程"></a>webpack 解析过程</h3><h3 id="自定义-Loader"><a href="#自定义-Loader" class="headerlink" title="自定义 Loader"></a>自定义 Loader</h3><p>Loader 是用于对模块的源代码进行转换（处理），Loader 本质上是一个导出为函数的 Js 模块，Loader  runner 库会调用这个函数，然后将上一个 loader 产生的结果或者资源文件传入进去</p>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name]-[contenthash:6].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;./loaders/loader04.js&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">name</span>: <span class="string">&#x27;zhangsan&#x27;</span>,</span><br><span class="line">              <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// &#123;</span></span><br><span class="line">      <span class="comment">//   test: /\.js$/,</span></span><br><span class="line">      <span class="comment">//   use: [</span></span><br><span class="line">      <span class="comment">//     // 可以使用相对路径，loader 将会从后往前进行加载</span></span><br><span class="line">      <span class="comment">//     &#x27;./loaders/loader01.js&#x27;,</span></span><br><span class="line">      <span class="comment">//     &#x27;./loaders/loader02.js&#x27;,</span></span><br><span class="line">      <span class="comment">//     &#x27;./loaders/loader03.js&#x27;,</span></span><br><span class="line">      <span class="comment">//   ]</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如下代码也将会从后往前加载</span></span><br><span class="line">      <span class="comment">// &#123;</span></span><br><span class="line">      <span class="comment">//   test: /\.js$/,</span></span><br><span class="line">      <span class="comment">//   use: &#x27;./loaders/loader01.js&#x27;</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">      <span class="comment">// &#123;</span></span><br><span class="line">      <span class="comment">//   test: /\.js$/,</span></span><br><span class="line">      <span class="comment">//   use: &#x27;./loaders/loader02.js&#x27;</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">      <span class="comment">// &#123;</span></span><br><span class="line">      <span class="comment">//   test: /\.js$/,</span></span><br><span class="line">      <span class="comment">//   use: &#x27;./loaders/loader03.js&#x27;</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>loader01.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; content 上一个 loader 返回的结果或者文件的内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; map 根 source map 有关</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; meta 元数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 返回处理后的内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content, map, meta</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;====================&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(content)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;====================&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="callback-函数"><a href="#callback-函数" class="headerlink" title="callback 函数"></a>callback 函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; content 上一个 loader 返回的结果或者文件的内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; map 根 source map 有关</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; meta 元数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 返回处理后的内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content, map, meta</span>) &#123;</span><br><span class="line">  <span class="comment">// 通过 callback 可以返回信息</span></span><br><span class="line">  <span class="keyword">const</span> callback = <span class="variable language_">this</span>.<span class="property">callback</span></span><br><span class="line">  <span class="comment">// 当 return 和 callabck 同时存在时，callback 返回的内容将会传递给下一个 loader</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 参数一： 异常信息</span></span><br><span class="line"><span class="comment">   * 参数二：返回给下一个 loader 的内容</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// callback(null, content + &#x27;\n//aaaaaaaaaaa&#x27;)</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当将 callback 放到异步函数里面，其返回值将不生效</span></span><br><span class="line">    <span class="comment">// 其后面的 loader 将不会延迟执行</span></span><br><span class="line">    <span class="title function_">callback</span>(<span class="literal">null</span>, content + <span class="string">&#x27;\n//aaaaaaaaaaa&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;==========2=========&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(content)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;====================&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="async-函数（异步函数）"><a href="#async-函数（异步函数）" class="headerlink" title="async 函数（异步函数）"></a>async 函数（异步函数）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; content 上一个 loader 返回的结果或者文件的内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; map 根 source map 有关</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; meta 元数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 返回处理后的内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content, map, meta</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> callabck = <span class="variable language_">this</span>.<span class="title function_">async</span>()</span><br><span class="line">  <span class="comment">// 通过 async 返回的函数作为异步函数，该 loader 将被视为一个异步 loader</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 下一个 loader 的 content 参数将会加上这个 loader 返回的结果，其优先级大于 return，return 返回的东西将不会生效</span></span><br><span class="line">    <span class="comment">// 其后面的 loader 将会延后执行</span></span><br><span class="line">    <span class="title function_">callabck</span>(<span class="literal">null</span>, content + <span class="string">&#x27;\n//3333333&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;==========3=========&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(content)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;====================&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="给-loader-传递参数"><a href="#给-loader-传递参数" class="headerlink" title="给 loader 传递参数"></a>给 loader 传递参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; getOptions &#125; = <span class="built_in">require</span>(<span class="string">&quot;loader-utils&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="comment">// 方式一：通过 loader-utils （webpack 开发）的库来获取</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getOptions</span>(<span class="variable language_">this</span>)) <span class="comment">// 现在执行将会报错 TypeError: getOptions is not a function</span></span><br><span class="line">  <span class="comment">// 方式二：通过 this.getOptions() 函数来获取</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="title function_">getOptions</span>()) <span class="comment">// &#123; name: &#x27;zhangsan&#x27;, age: 18 &#125;</span></span><br><span class="line">  <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="对传入的参数进行校验"><a href="#对传入的参数进行校验" class="headerlink" title="对传入的参数进行校验"></a>对传入的参数进行校验</h4><p>需要使用第三方库的支持</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install schema-utils -D</span><br></pre></td></tr></table></figure>

<p>loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; validate &#125; = <span class="built_in">require</span>(<span class="string">&#x27;schema-utils&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> options = <span class="variable language_">this</span>.<span class="title function_">getOptions</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 参数一：校验的规则</span></span><br><span class="line"><span class="comment">   * 参数二：需要校验的数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">validate</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">    <span class="attr">properties</span>: &#123;</span><br><span class="line">      <span class="string">&quot;username&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;age&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, options)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="markdown-loader"><a href="#markdown-loader" class="headerlink" title="markdown loader"></a>markdown loader</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; marked &#125; = <span class="built_in">require</span>(<span class="string">&#x27;marked&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> hljs = <span class="built_in">require</span>(<span class="string">&#x27;highlight.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> renderer = &#123;</span><br><span class="line">  <span class="title function_">code</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      type: &#x27;code&#x27;,</span></span><br><span class="line"><span class="comment">      raw: &#x27;```javascript\n&#x27; +</span></span><br><span class="line"><span class="comment">        &quot;const a = &#x27;213&#x27;\n&quot; +</span></span><br><span class="line"><span class="comment">        &#x27;let obj = &#123;\n&#x27; +</span></span><br><span class="line"><span class="comment">        &#x27;  age: 18\n&#x27; +</span></span><br><span class="line"><span class="comment">        &#x27;&#125;\n&#x27; +</span></span><br><span class="line"><span class="comment">        &quot;console.log(&#x27;aaa&#x27;)\n&quot; +</span></span><br><span class="line"><span class="comment">        &#x27;```&#x27;,</span></span><br><span class="line"><span class="comment">      lang: &#x27;javascript&#x27;,</span></span><br><span class="line"><span class="comment">      text: &quot;const a = &#x27;213&#x27;\nlet obj = &#123;\n  age: 18\n&#125;\nconsole.log(&#x27;aaa&#x27;)&quot;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line">    <span class="keyword">const</span> language = hljs.<span class="title function_">getLanguage</span>(obj.<span class="property">lang</span>) ? obj.<span class="property">lang</span> : <span class="string">&#x27;plaintext&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> highlightedCode = hljs.<span class="title function_">highlight</span>(obj.<span class="property">text</span>, &#123; language &#125;).<span class="property">value</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`&lt;pre&gt;&lt;code class=&quot;hljs <span class="subst">$&#123;language&#125;</span>&quot;&gt;<span class="subst">$&#123;highlightedCode&#125;</span>&lt;/code&gt;&lt;/pre&gt;`</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (__) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`&lt;pre&gt;&lt;code class=&quot;hljs <span class="subst">$&#123;language&#125;</span>&quot;&gt;<span class="subst">$&#123;obj.text&#125;</span>&lt;/code&gt;&lt;/pre&gt;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">content</span>) &#123;</span><br><span class="line">  marked.<span class="title function_">use</span>(&#123; <span class="attr">renderer</span>: renderer &#125;)</span><br><span class="line">  <span class="keyword">const</span> htmlContent = <span class="title function_">marked</span>(content)</span><br><span class="line">  <span class="keyword">const</span> moduleContent = <span class="string">`var md = \`<span class="subst">$&#123;htmlContent&#125;</span>\`; export default md`</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> moduleContent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="自定义插件"><a href="#自定义插件" class="headerlink" title="自定义插件"></a>自定义插件</h3><p>webpack 中的compiler 和 compilation 通过注入插件的方式，来监听 webpack 的声明周期，其创建了 Tapable 库中的各种 Hook 的实例</p>
<ol>
<li>webpack 函数中的 createCompiler 方法中，注册了所有的插件</li>
<li>在注册插件时，会调用插件函数或者插件对象的 apply 方法</li>
<li>插件方法会接受 compiler 对象，我们可以通过 compiler 对象来注册 Hook 事件</li>
<li>某些插件也会传入一个 compilation 的对象，我们也可以监听 compilation 的 hook 事件</li>
</ol>
<h4 id="Tapable"><a href="#Tapable" class="headerlink" title="Tapable"></a>Tapable</h4><p>Tapable 是管理着需要的 Hook，这些 Hook 可以被应用到我们的插件中</p>
<ul>
<li>bail：当有返回值时，就不会执行后续的事件触发了</li>
<li>loop：当返回值为 true，就会反复执行该事件，当返回值为 undefined 或者不返回内容时，就退出事件</li>
<li>waterfall：当返回值不为 undefined 时，会将这次放回的结果作为下次事件的第一个参数</li>
<li>parallel：并行，会同时执行事件处理回调结束，不会等到这个事件执行结束才执行下一次事件处理回调</li>
<li>series：串行，会等待上一次异步的 Hook</li>
</ul>
<p>官方提供的 Hook</p>
<ul>
<li>同步 Hook：SyncHook、SyncBailHook、SyncWatefallHook、SyncLoopHook</li>
<li>异步 Hook，两个事件处理回调，不会等待上一次处理回调结果后再执行下一次回调<ul>
<li>Paralle（并行）：AsyncPralleHook、AsyncParalleBailHook</li>
<li>Series（串行）：AsyncSeriesHook、AsyncSeriesBailHook、AsyncSeriesWaterfallHook</li>
</ul>
</li>
</ul>
<p>安装 tapable 库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install tapable -D</span><br></pre></td></tr></table></figure>

<p>基本使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">SyncHook</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler1</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">      <span class="comment">// 定义 hook， name，age 为调用这个 hook 需要传递的参数</span></span><br><span class="line">      <span class="attr">syncHook</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 hook 监听事件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">syncHook</span>.<span class="title function_">tap</span>(<span class="string">&#x27;event1&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute&#x27;</span>, name, age)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">syncHook</span>.<span class="title function_">tap</span>(<span class="string">&#x27;event2&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute 2&#x27;</span>, name, age)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = <span class="keyword">new</span> <span class="title class_">Compiler1</span>()</span><br><span class="line">compiler.<span class="property">hooks</span>.<span class="property">syncHook</span>.<span class="title function_">call</span>(<span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">18</span>)</span><br></pre></td></tr></table></figure>

<p>bail</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">SyncBailHook</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler1</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">      <span class="comment">// 定义 hook， name，age 为调用这个 hook 需要传递的参数</span></span><br><span class="line">      <span class="attr">bailHook</span>: <span class="keyword">new</span> <span class="title class_">SyncBailHook</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 hook 监听事件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">bailHook</span>.<span class="title function_">tap</span>(<span class="string">&#x27;event1&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute&#x27;</span>, name, age)</span><br><span class="line">      <span class="comment">// 当存在返回值时，后续的回调将不会执行</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">bailHook</span>.<span class="title function_">tap</span>(<span class="string">&#x27;event2&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute 2&#x27;</span>, name, age)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = <span class="keyword">new</span> <span class="title class_">Compiler1</span>()</span><br><span class="line">compiler.<span class="property">hooks</span>.<span class="property">bailHook</span>.<span class="title function_">call</span>(<span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">18</span>)</span><br></pre></td></tr></table></figure>

<p>loop</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">SyncLoopHook</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler1</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">      <span class="comment">// 定义 hook， name，age 为调用这个 hook 需要传递的参数</span></span><br><span class="line">      <span class="attr">loopHook</span>: <span class="keyword">new</span> <span class="title class_">SyncLoopHook</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 hook 监听事件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">loopHook</span>.<span class="title function_">tap</span>(<span class="string">&#x27;event1&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute&#x27;</span>, name, age)</span><br><span class="line">      <span class="comment">// 当不存在返回值或者返回值为 undefined 时将会中断循环</span></span><br><span class="line">      <span class="keyword">return</span> count -- === <span class="number">0</span> ? <span class="literal">undefined</span> : count</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">loopHook</span>.<span class="title function_">tap</span>(<span class="string">&#x27;event2&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute 2&#x27;</span>, name, age)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = <span class="keyword">new</span> <span class="title class_">Compiler1</span>()</span><br><span class="line">compiler.<span class="property">hooks</span>.<span class="property">loopHook</span>.<span class="title function_">call</span>(<span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">18</span>)</span><br></pre></td></tr></table></figure>

<p>waterfall</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">SyncWaterfallHook</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler1</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">      <span class="comment">// 定义 hook， name，age 为调用这个 hook 需要传递的参数</span></span><br><span class="line">      <span class="attr">waterfallHook</span>: <span class="keyword">new</span> <span class="title class_">SyncWaterfallHook</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 hook 监听事件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">waterfallHook</span>.<span class="title function_">tap</span>(<span class="string">&#x27;event1&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute&#x27;</span>, name, age)</span><br><span class="line">      <span class="comment">// 返回值不为 undefined 时，将作为下一个回调函数第一个参数</span></span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span> &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">waterfallHook</span>.<span class="title function_">tap</span>(<span class="string">&#x27;event2&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute 2&#x27;</span>, name, age) <span class="comment">// hook1 execute 2 &#123; gender: &#x27;male&#x27; &#125; 18</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = <span class="keyword">new</span> <span class="title class_">Compiler1</span>()</span><br><span class="line">compiler.<span class="property">hooks</span>.<span class="property">waterfallHook</span>.<span class="title function_">call</span>(<span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">18</span>)</span><br></pre></td></tr></table></figure>

<p>parallel</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">AsyncParallelHook</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler1</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">      <span class="comment">// 定义 hook， name，age 为调用这个 hook 需要传递的参数</span></span><br><span class="line">      <span class="attr">parallelHook</span>: <span class="keyword">new</span> <span class="title class_">AsyncParallelHook</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 hook 监听事件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">parallelHook</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;event1&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute&#x27;</span>, name, age)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">parallelHook</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;event2&#x27;</span>, <span class="function">(<span class="params">name, age</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute 2&#x27;</span>, name, age)</span><br><span class="line">      &#125;, <span class="number">900</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = <span class="keyword">new</span> <span class="title class_">Compiler1</span>()</span><br><span class="line">compiler.<span class="property">hooks</span>.<span class="property">parallelHook</span>.<span class="title function_">callAsync</span>(<span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="comment">// 输出结果</span></span><br><span class="line"><span class="comment">// hook1 execute 2 zhangsan 18</span></span><br><span class="line"><span class="comment">// hook1 execute zhangsan 18</span></span><br></pre></td></tr></table></figure>

<p>series</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">AsyncSeriesHook</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler1</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">      <span class="comment">// 定义 hook， name，age 为调用这个 hook 需要传递的参数</span></span><br><span class="line">      <span class="attr">serieslHook</span>: <span class="keyword">new</span> <span class="title class_">AsyncSeriesHook</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 hook 监听事件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">serieslHook</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;event1&#x27;</span>, <span class="function">(<span class="params">name, age, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute&#x27;</span>, name, age)</span><br><span class="line">        <span class="comment">// 调用 callback 下面的任务才会执行</span></span><br><span class="line">        <span class="title function_">callback</span>()</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">serieslHook</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;event2&#x27;</span>, <span class="function">(<span class="params">name, age, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook1 execute 2&#x27;</span>, name, age)</span><br><span class="line">        <span class="title function_">callback</span>()</span><br><span class="line">      &#125;, <span class="number">900</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = <span class="keyword">new</span> <span class="title class_">Compiler1</span>()</span><br><span class="line">compiler.<span class="property">hooks</span>.<span class="property">serieslHook</span>.<span class="title function_">callAsync</span>(<span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">18</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;all tasks finished&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 输出结果</span></span><br><span class="line"><span class="comment">// hook1 execute zhangsan 18</span></span><br><span class="line"><span class="comment">// hook1 execute 2 zhangsan 18</span></span><br><span class="line"><span class="comment">// all tasks finished</span></span><br></pre></td></tr></table></figure>



<h2 id="Babel"><a href="#Babel" class="headerlink" title="Babel"></a>Babel</h2><blockquote>
<p>babel 是一个工具链，主要用于就浏览器或者环境中的 ECMAScript2015 + 代码转化为向后兼容版本的 JavaScript</p>
<ul>
<li>包括：语法转换、源代码转换、Polyfill 实现目标环境缺少的功能等</li>
<li>需下载 @babel&#x2F;core @babel&#x2F;cli</li>
</ul>
</blockquote>
<p>在使用 babel 命令时可以设置 plugins 参数，将其转换为使用该插件后的代码：</p>
<p>转化箭头函数为普通函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># transform arrow function to function</span></span><br><span class="line">npm install @babel/plugin-transform-arrow-functions -D</span><br><span class="line">npx babel src --out-dir dist --plugin@babel/plugin-transform-arrow-functions</span><br></pre></td></tr></table></figure>

<p>转化块级作用域</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># transform block scoping</span></span><br><span class="line">npm install @babel/plugin-transform-block-scoping -D</span><br><span class="line">npm babel src --out-dir dist --plugin@babel/plugin-transform-block-scoping,@babel/plugin-transform-arrow-functions</span><br></pre></td></tr></table></figure>

<h3 id="解析原理"><a href="#解析原理" class="headerlink" title="解析原理"></a>解析原理</h3><p><a target="_blank" rel="noopener" href="https://github.com/jamiebuilds/the-super-tiny-compiler">https://github.com/jamiebuilds/the-super-tiny-compiler</a></p>
<p><img src="/.%5Cimgs%5Cbabel" alt="1735832299456"></p>
<ol>
<li>解析阶段（Parsing）</li>
<li>转换阶段（Transformation）</li>
<li>生成阶段（Code Generation）</li>
</ol>
<h3 id="预设"><a href="#预设" class="headerlink" title="预设"></a>预设</h3><p>安装 @babel&#x2F;preset-env</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/preset-env -D</span><br><span class="line"></span><br><span class="line">npx babel ./src --out-dir ./dist --presets=@babel/preset-env</span><br></pre></td></tr></table></figure>

<h3 id="babel-配置文件"><a href="#babel-配置文件" class="headerlink" title="babel 配置文件"></a>babel 配置文件</h3><p>可以将 babel 的配置信息编写到一个文件中</p>
<ul>
<li>babel.config.json（或 .js, .cjs, .mjs）文件（推荐）<ul>
<li>可以直接作用于 Monorepos 项目的子包，更加推荐</li>
</ul>
</li>
<li>.babelrc.json （或 .babelrc, .js, .cjs, .mjs）文件<ul>
<li>早期使用较多的配置方案，但是对于配置 Monorepos 项目是比较麻烦的</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// babel.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="Browserslist-插件"><a href="#Browserslist-插件" class="headerlink" title="Browserslist 插件"></a>Browserslist 插件</h2><p>Browserslist 可以在不同的的前端工具之间，共享目标浏览器和 Node.js 版本的配置</p>
<p>条件查询使用的是 caiuse-lite 的工具，这个工具的数据来自于 caniuse 的网站上</p>
<p>browserslist 编写规则：</p>
<ul>
<li>defaults：browserslist 的默认浏览器（&gt;0.5%, last 2 versions, Firefox ESR, not dead）</li>
<li>5%：通过全局使用情况统计信息选择的浏览器版本，&gt;&#x3D;, &lt; 和 &lt;&#x3D;</li>
</ul>
<p>dead：24 个月内没有官方支持或更新的浏览器</p>
<p>last 2 versions：每个浏览器的最后两个版本</p>
<h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><ol>
<li>可以在 package.json 文件中编写</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;browserlists&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;last 2 versions&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;not dead&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;&gt; 0.2%&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 .browserslistrc 文件中编写（最常使用）<ol>
<li>该配置将会在多个工具之间进行共享（postcss&#x2F;babel）</li>
</ol>
</li>
</ol>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt; 0.2%</span></span><br><span class="line">last 2 versions</span><br><span class="line">not dead</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>可以在 webpack.config.js 文件中配置（不常用）</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [</span><br><span class="line">              [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">targets</span>: <span class="string">&#x27;&gt;5%&#x27;</span>, <span class="comment">// 将会覆盖 browserslist 文件中的内容</span></span><br><span class="line">              &#125;]</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Polyfill"><a href="#Polyfill" class="headerlink" title="Polyfill"></a>Polyfill</h2><p>将一些高版本 js 代码对应于低版本中不存在的 API（Promise，string.includes 等函数）采用补丁的方式进行替换</p>
<p>安装对应依赖（开发和生产环境都需要依赖）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install core-js regenerator-runtime</span><br></pre></td></tr></table></figure>

<p>useBuiltIns 属性的可选值：</p>
<ol>
<li>false：<ul>
<li>打包后的文件不适用 polyfill 来进行适配</li>
<li>并且这个时候是不需要设置 corejs 属性的</li>
</ul>
</li>
<li>usage：<ul>
<li>会根据源代码中出现的语言特性，自动检测所需要的 polyfill</li>
<li>这样可以确保最终包离的 polyfill 数量的最小化，打包的包相对较小</li>
<li>可以设置 corejs 属性来确定使用的 corejs 的版本</li>
</ul>
</li>
<li>entry<ul>
<li>如果我们依赖的某一个库本身使用了 polyfill 的特性，但是因为我们使用的是 usage，所以之后用户浏览器可能会报错，如果担心这种情况，可以使用 entry</li>
<li>并且需要在入口文件中添加 <code>import &#39;core-js/stable&#39;; import &#39;regenerator-runtime/runtime&#39;;</code> </li>
<li>这样做会根据 browserslist 目标导入所有的 polyfill，但是对应的包会很大</li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">corejs</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">useBuiltIns</span>: <span class="string">&#x27;entry&#x27;</span> <span class="comment">// 表示不使用 polyfill，可选值：【false|usage(使用polyfill进行填充)|entry】</span></span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>入口文件 main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;core-js/stable&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;regenerator-runtime/runtime&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>



<h2 id="CDN-服务器"><a href="#CDN-服务器" class="headerlink" title="CDN 服务器"></a>CDN 服务器</h2><p>CDN 称之为内容分发网络（Content Delivery Network 或 Content Distribution Network）</p>
<ul>
<li>它是指通过相互连接的网络系统，利用最靠近每个用户的服务器</li>
<li>更快、更可靠的将音乐、图片、视频、应用程序以及其他文件发送给用户</li>
<li>来提供高性能、可扩展性及低成本的网络内容传递给用户</li>
</ul>
<p>在开发中，我们使用 CDN 主要是两种方式</p>
<ol>
<li><p>打包所有的静态资源，放到 CDN 服务器，用户所有资源都是通过 CDN 服务器加载的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name]-bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&#x27;[name]_chunk.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// path 必须指定绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// when rebuild, the output dir will be cleaned</span></span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;https://xxxcdn.com&#x27;</span>, <span class="comment">// 设置 CDN 服务器域名</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>一些第三方资源放到 CDN 服务器上</p>
<p>国内 CDN 平台 <a target="_blank" rel="noopener" href="https://www.bootcdn.cn/">BOOTCDN</a> </p>
<p>在 模板 index 中直接引入需要从 CDN 引用的第三方库</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/react/18.3.1/umd/react.production.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 webpack 中配置相应从 CDN 引用的包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">externals</span>: &#123;</span><br><span class="line">    <span class="comment">// key: 排除框架的名称，import xxx from &#x27;key&#x27;</span></span><br><span class="line">    <span class="comment">// value：从 CDN 请求下来的 js 中提供的对应名称</span></span><br><span class="line">    <span class="attr">react</span>: <span class="string">&#x27;React&#x27;</span>,</span><br><span class="line">    <span class="comment">// react_dom: &#x27;ReactDom&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Gulp"><a href="#Gulp" class="headerlink" title="Gulp"></a>Gulp</h2><p>gulp 的核心理念是 task runner</p>
<ul>
<li>可以定义自己的一系列任务，等待任务被执行</li>
<li>基于文件 stream 的构建流</li>
<li>我们可以使用 gulp 的插件体系来完成某些任务</li>
</ul>
<p>webpack 的核心理念是 module bundler</p>
<ul>
<li>webpack 是一个模块化的打包工具</li>
<li>可以使用各种各样的 loader 来加载不同的模块</li>
<li>可以使用各种各样的插件在 webpack 打包的生命周期完成其他任务</li>
</ul>
<p>gulp 相对于 webpack 的优缺点</p>
<ul>
<li>gulp 相对于 webpack 思想更加的简单、医用，更适合编写一些自动化的任务</li>
<li>但是目前对于大型项目（Vue、React、Angular）并不会使用 gulp 来构建，比如默认 gulp 是不支持模块化的</li>
</ul>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>安装对应依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp</span><br></pre></td></tr></table></figure>

<p>编写 gulpfile 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 npx gulp foo1 执行</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo1</span> = (<span class="params">callback</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;task 1 finished&#x27;</span>)</span><br><span class="line">  <span class="comment">// 需要调用 callback 才能知道该任务已完成</span></span><br><span class="line">  <span class="title function_">callback</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行方式二</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;foo2&#x27;</span>, <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;task 2 finished&#x27;</span>)</span><br><span class="line">  <span class="title function_">callback</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  foo1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认任务 通过 npx gulp</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">default</span> = <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;default task finished&#x27;</span>)</span><br><span class="line">  <span class="title function_">callback</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建-gulp-任务"><a href="#创建-gulp-任务" class="headerlink" title="创建 gulp 任务"></a>创建 gulp 任务</h3><p>每个 gulp 任务都是一个异步的 JavaScript 代码</p>
<ul>
<li>此函数可以接收一个 callback 作为参数，调用 callback 函数，那么该任务会结束</li>
<li>或者是一个返回 stream、promise、event emitter、child process 或 observable 类型的函数</li>
</ul>
<p>任务可以是 public 或者 private 类型的</p>
<ul>
<li>公开任务（public tasks）从 gulpfile 中被导出（export），可以通过 gulp 命令直接调用</li>
<li>私有任务（private tasks）被设计为在内部使用，通常作为 series() 或 parallel() 组合的组成部分</li>
</ul>
<p><em>在 gulp 4 之前，注册任务时需要通过 gulp.task 的方式进行注册，也即上面的方式二</em></p>
<h3 id="多任务"><a href="#多任务" class="headerlink" title="多任务"></a>多任务</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; series, parallel &#125; = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 npx gulp foo1 执行</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo1</span> = (<span class="params">callback</span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo1&#x27;</span>)</span><br><span class="line">    <span class="title function_">callback</span>()</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo2</span> = (<span class="params">callback</span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo2&#x27;</span>)</span><br><span class="line">    <span class="title function_">callback</span>()</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo3</span> = (<span class="params">callback</span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo3&#x27;</span>)</span><br><span class="line">    <span class="title function_">callback</span>()</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 任务会依次执行</span></span><br><span class="line"><span class="keyword">const</span> seriesTask = <span class="title function_">series</span>(foo1, foo2, foo3)</span><br><span class="line"><span class="comment">// 任务将并行执行</span></span><br><span class="line"><span class="keyword">const</span> parallelTask = <span class="title function_">parallel</span>(foo1, foo2, foo3)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  seriesTask,</span><br><span class="line">  parallelTask</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="读写文件"><a href="#读写文件" class="headerlink" title="读写文件"></a>读写文件</h3><p>gulp 暴露了 src 和 dest 函数，用于处理计算机存放的文件</p>
<ul>
<li>src 接收一个正则路径，并从文件系统中读取文件然后生成一个 Node 流（Stream），它将所有匹配的文件放入内存中并通过读取流（Stream进行处理）</li>
<li>由 src 产生的流（Stream）应当从任务（task 函数）中返回并发出异步完成的信号</li>
<li>dest 接收一个输出目录作为参数，并且它还会产生一个 Node 流（Stream），通过该流将文件内容输出到文件中</li>
</ul>
<p>pipe 方法接收一个转换流（Transform stream）或 可写流（Writable Stream）</p>
<p>转换流或可写流，拿到数据之后可以对数据进行操作，再次传递给下一个转换流或可写流</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest &#125; = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">copyFile</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;./src/**&#x27;</span>).<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;./dist&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  copyFile</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="对-Js-文件进行转化和压缩"><a href="#对-Js-文件进行转化和压缩" class="headerlink" title="对 Js 文件进行转化和压缩"></a>对 Js 文件进行转化和压缩</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, watch &#125; = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&#x27;gulp-babel&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> terser = <span class="built_in">require</span>(<span class="string">&#x27;gulp-terser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">zipFile</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;./src/**&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">babel</span>(&#123; <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]&#125;))</span><br><span class="line">    <span class="comment">// .pipe(terser(&#123; mangle: &#123; toplevel: true &#125;&#125;))</span></span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">terser</span>(&#123; <span class="attr">toplevel</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;./dist&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置自动监听</span></span><br><span class="line"><span class="title function_">watch</span>(<span class="string">&#x27;./src/**/*js&#x27;</span>, zipFile)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  zipFile</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="搭建项目"><a href="#搭建项目" class="headerlink" title="搭建项目"></a>搭建项目</h3><p>安装依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-babel gulp-terser gulp-htmlmin gulp-less gulp-inject -D</span><br></pre></td></tr></table></figure>

<p>html 文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- inject:css --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- endinject --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- inject:js --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- endinject --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>gulpfile.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, series, parallel, watch &#125; = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&#x27;gulp-babel&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> terser = <span class="built_in">require</span>(<span class="string">&#x27;gulp-terser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> less = <span class="built_in">require</span>(<span class="string">&#x27;gulp-less&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> inject = <span class="built_in">require</span>(<span class="string">&#x27;gulp-inject&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlmin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlmin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">&#x27;browser-sync&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">jsTask</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;./src/**/*.js&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">babel</span>(&#123; <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>] &#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">terser</span>(&#123; <span class="attr">mangle</span>: &#123; <span class="attr">toplevel</span>: <span class="literal">true</span> &#125;&#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;./dist/js&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">cssTask</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;./src/**/*.less&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">less</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;./dist/css&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">htmlTask</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;./src/**/*.html&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">htmlmin</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;./dist&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注入时使用相对路径设置 relative 为 true</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">injectTask</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;./dist/**/*.html&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">inject</span>(<span class="title function_">src</span>([<span class="string">&#x27;./dist/**/*.js&#x27;</span>, <span class="string">&#x27;./dist/**/*.css&#x27;</span>]), &#123; <span class="attr">relative</span>: <span class="literal">true</span>&#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;./dist&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开启本地服务</span></span><br><span class="line"><span class="keyword">const</span> bs = browserSync.<span class="title function_">create</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">serveTask</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  bs.<span class="title function_">init</span>(&#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8000</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">files</span>: <span class="string">&#x27;./dist/*&#x27;</span>,</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">      <span class="attr">baseDir</span>: <span class="string">&#x27;./dist&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> parallelTask = <span class="title function_">parallel</span>(jsTask, cssTask, htmlTask)</span><br><span class="line"><span class="keyword">const</span> buildTask = <span class="title function_">series</span>(parallelTask, injectTask)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(<span class="string">&#x27;./src/**/*&#x27;</span>, buildTask)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serve = <span class="title function_">series</span>(buildTask, serveTask)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  serve,</span><br><span class="line">  buildTask</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">default</span> = buildTask</span><br></pre></td></tr></table></figure>



<h2 id="Rollup"><a href="#Rollup" class="headerlink" title="Rollup"></a>Rollup</h2><p>Rollup 是一个 JavaScript 的模块化打包工具，可以帮助我们编译小的代码到一个大的，复杂的代码中，比如一个库一个应用程序</p>
<h3 id="rollup-VS-webpack"><a href="#rollup-VS-webpack" class="headerlink" title="rollup VS webpack"></a>rollup VS webpack</h3><ul>
<li>rollup 是一个模块化的打包工具，但是 rollup 主要是针对 ESModule 进行打包的</li>
<li>另外 webpack 通常可以通过各种 loader 处理各样的文件，以及他们之间的依赖关系</li>
<li>rollup 更多时候是专注于处理 JavaScript 代码的（当然也可以是 css、font、vue 等文件）</li>
<li>另外 rollup 的配置和理念相对于 webpack 来说，更加的简洁和容易理解</li>
<li>在早期 webpack 不支持 tree shaking 时，rollup 具备更强的优势</li>
</ul>
<p>通常在实际项目开发过程中，我们都会使用 webpack（比如 react、angular 项目都是基于 webpack）</p>
<p>在对库文件进行打包时，我们通常会使用 rollup （比如 vue、react、dayjs 源码本身都是基于 rollup的，vite 底层使用 rollup）</p>
<h3 id="rollup-基本使用"><a href="#rollup-基本使用" class="headerlink" title="rollup 基本使用"></a>rollup 基本使用</h3><p>安装 rollup</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install rollup -D</span><br></pre></td></tr></table></figure>

<p>使用命令进行打包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打包为 node 环境</span></span><br><span class="line">npx rollup ./src/main.js -f cjs -o dist/bundle.cjs</span><br><span class="line"><span class="comment"># 打包为浏览器环境</span></span><br><span class="line">npx rollup ./src/main.js -f iife -o dist/bundle.cjs</span><br><span class="line"><span class="comment"># 打包为 amd 环境</span></span><br><span class="line">npx rollup ./src/main.js -f cjs -o dist/bundle.cjs</span><br><span class="line"><span class="comment"># 打包为所有环境都支持，此时必须要指定名字</span></span><br><span class="line">npx rollup ./src/main.js -f umd --name foo -o dist/bundle.cjs</span><br></pre></td></tr></table></figure>

<p>原始代码内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello&#x27;</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="string">&#x27;zhangsan&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; foo &#125;</span><br></pre></td></tr></table></figure>



<p>打包后的代码结构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"><span class="variable language_">global</span>, factory</span>) &#123;</span><br><span class="line">  <span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">module</span> !== <span class="string">&#x27;undefined&#x27;</span> ? <span class="title function_">factory</span>(<span class="built_in">exports</span>) :</span><br><span class="line">  <span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.<span class="property">amd</span> ? <span class="title function_">define</span>([<span class="string">&#x27;exports&#x27;</span>], factory) :</span><br><span class="line">  (<span class="variable language_">global</span> = <span class="keyword">typeof</span> globalThis !== <span class="string">&#x27;undefined&#x27;</span> ? globalThis : <span class="variable language_">global</span> || self, <span class="title function_">factory</span>(<span class="variable language_">global</span>.<span class="property">foo</span> = &#123;&#125;));</span><br><span class="line">&#125;)(<span class="variable language_">this</span>, (<span class="keyword">function</span> (<span class="params"><span class="built_in">exports</span></span>) &#123; <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello&#x27;</span>, name);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">foo</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">exports</span>.<span class="property">foo</span> = foo;</span><br><span class="line"></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对上述代码的解析</span></span><br><span class="line"><span class="comment">// 打包后的代码定义了一个函数，该函数接收两个参数 global 和 factory，factory 为函数</span></span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">function</span> (<span class="params"><span class="variable language_">global</span>, factory</span>) &#123;</span><br><span class="line">  <span class="comment">// 判断是否存在 exports，并且 module 存在，则将 exports 传入</span></span><br><span class="line">  <span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">module</span> !== <span class="string">&#x27;undefined&#x27;</span> ? <span class="title function_">factory</span>(<span class="built_in">exports</span>) :</span><br><span class="line">  <span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.<span class="property">amd</span> ? <span class="title function_">define</span>([<span class="string">&#x27;exports&#x27;</span>], factory) :</span><br><span class="line">  <span class="comment">// 在浏览器中会存在 global 和 globalThis 变量指向 window，相当于传入 factory为 window.foo = &#123;&#125;</span></span><br><span class="line">  (<span class="variable language_">global</span> = <span class="keyword">typeof</span> globalThis !== <span class="string">&#x27;undefined&#x27;</span> ? globalThis : <span class="variable language_">global</span> || self, <span class="title function_">factory</span>(<span class="variable language_">global</span>.<span class="property">foo</span> = &#123;&#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 this 和 另外一个函数 传入该函数，执行该函数后，将会对全局对象绑定对应的属性</span></span><br><span class="line"><span class="title function_">foo</span>(<span class="variable language_">this</span>, (<span class="keyword">function</span> (<span class="params"><span class="built_in">exports</span></span>) &#123; <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello&#x27;</span>, name);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">foo</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// exports 将为对应环境中的 this（浏览器环境中 window，globalThis，this） 或 exports（node 环境中）</span></span><br><span class="line">  <span class="built_in">exports</span>.<span class="property">foo</span> = foo;</span><br><span class="line"></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<p>编写相应配置文件，通过 <code>npx rollup -c</code> 执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口文件</span></span><br><span class="line">  <span class="attr">input</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 打包后的格式</span></span><br><span class="line">    <span class="attr">format</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">    <span class="comment">// 当使用 umd 时，需要执行名称</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="comment">// 输出的文件</span></span><br><span class="line">    <span class="attr">file</span>: <span class="string">&#x27;./dist/bundle.umd.js&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对项目进行打包</p>
<p>一般情况下不需要打包 node_modules 文件中的内容，用户可以通过依赖进行安装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 由于 loadsh 是通过 commonjs 导出的，默认情况下，rollup 不会对其进行打包</span></span><br><span class="line"><span class="comment">// 需要安装 @rollup/plugin-commonjs 解决 使用 esmodule 方式导入 commonjs 包</span></span><br><span class="line"><span class="comment">// 安装 @rollup/plugin-node-resolve 解决 打包 node_modules 文件中的内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;loadsh&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(_.<span class="title function_">join</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello&#x27;</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="string">&#x27;zhangsan&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; foo &#125;</span><br></pre></td></tr></table></figure>

<p>rollup.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用该插件可以通过 commonjs 导出，使用 esmodule 方式导入</span></span><br><span class="line"><span class="keyword">const</span> commonjs = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-commonjs&#x27;</span>)</span><br><span class="line"><span class="comment">// 解决 打包 node_modules 文件中的内容</span></span><br><span class="line"><span class="keyword">const</span> nodeResolve = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-node-resolve&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口文件</span></span><br><span class="line">  <span class="attr">input</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 打包后的格式</span></span><br><span class="line">    <span class="attr">format</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">    <span class="comment">// 当使用 umd 时，需要执行名称</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="comment">// 输出的文件</span></span><br><span class="line">    <span class="attr">file</span>: <span class="string">&#x27;./build/bundle.umd.js&#x27;</span>,</span><br><span class="line">    <span class="attr">globals</span>: &#123;</span><br><span class="line">      <span class="attr">loadsh</span>: <span class="string">&#x27;_&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">commonjs</span>(),</span><br><span class="line">    <span class="title function_">nodeResolve</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对代码进行转化并压缩</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用该插件可以通过 commonjs 导出，使用 esmodule 方式导入</span></span><br><span class="line"><span class="keyword">const</span> commonjs = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-commonjs&#x27;</span>)</span><br><span class="line"><span class="comment">// 解决 打包 node_modules 文件中的内容</span></span><br><span class="line"><span class="keyword">const</span> nodeResolve = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-node-resolve&#x27;</span>)</span><br><span class="line"><span class="comment">// 对代码进行转换</span></span><br><span class="line"><span class="keyword">const</span> &#123;babel&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-babel&#x27;</span>)</span><br><span class="line"><span class="comment">// 对代码进行压缩</span></span><br><span class="line"><span class="keyword">const</span> terser = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-terser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口文件</span></span><br><span class="line">  <span class="attr">input</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 打包后的格式</span></span><br><span class="line">    <span class="attr">format</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">    <span class="comment">// 当使用 umd 时，需要执行名称</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="comment">// 输出的文件</span></span><br><span class="line">    <span class="attr">file</span>: <span class="string">&#x27;./build/bundle.umd.js&#x27;</span>,</span><br><span class="line">    <span class="attr">globals</span>: &#123;</span><br><span class="line">      <span class="attr">loadsh</span>: <span class="string">&#x27;_&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">commonjs</span>(),</span><br><span class="line">    <span class="comment">// nodeResolve(),</span></span><br><span class="line">    <span class="title function_">babel</span>(&#123;</span><br><span class="line">      <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">terser</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理-CSS-文件"><a href="#处理-CSS-文件" class="headerlink" title="处理 CSS 文件"></a>处理 CSS 文件</h3><p>安装对应的插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install rollup-plugin-postcss postcss-preset-env -D</span><br></pre></td></tr></table></figure>

<p>配置 rollup</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用该插件可以通过 commonjs 导出，使用 esmodule 方式导入</span></span><br><span class="line"><span class="keyword">const</span> commonjs = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-commonjs&#x27;</span>)</span><br><span class="line"><span class="comment">// 解决 打包 node_modules 文件中的内容</span></span><br><span class="line"><span class="keyword">const</span> nodeResolve = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-node-resolve&#x27;</span>)</span><br><span class="line"><span class="comment">// 对代码进行转换</span></span><br><span class="line"><span class="keyword">const</span> &#123;babel&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-babel&#x27;</span>)</span><br><span class="line"><span class="comment">// 对代码进行压缩</span></span><br><span class="line"><span class="keyword">const</span> terser = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-terser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> postcss = <span class="built_in">require</span>(<span class="string">&#x27;rollup-plugin-postcss&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口文件</span></span><br><span class="line">  <span class="attr">input</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 打包后的格式</span></span><br><span class="line">    <span class="attr">format</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">    <span class="comment">// 当使用 umd 时，需要执行名称</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="comment">// 输出的文件</span></span><br><span class="line">    <span class="attr">file</span>: <span class="string">&#x27;./build/bundle.umd.js&#x27;</span>,</span><br><span class="line">    <span class="attr">globals</span>: &#123;</span><br><span class="line">      <span class="attr">loadsh</span>: <span class="string">&#x27;_&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">commonjs</span>(),</span><br><span class="line">    <span class="comment">// nodeResolve(),</span></span><br><span class="line">    <span class="title function_">babel</span>(&#123;</span><br><span class="line">      <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">terser</span>(),</span><br><span class="line">    <span class="title function_">postcss</span>(&#123;</span><br><span class="line">      <span class="attr">plugins</span>: [<span class="built_in">require</span>(<span class="string">&#x27;postcss-preset-env&#x27;</span>)]</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="对-vue-进行打包"><a href="#对-vue-进行打包" class="headerlink" title="对 vue 进行打包"></a>对 vue 进行打包</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用该插件可以通过 commonjs 导出，使用 esmodule 方式导入</span></span><br><span class="line"><span class="keyword">const</span> commonjs = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-commonjs&#x27;</span>)</span><br><span class="line"><span class="comment">// 解决 打包 node_modules 文件中的内容</span></span><br><span class="line"><span class="keyword">const</span> nodeResolve = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-node-resolve&#x27;</span>)</span><br><span class="line"><span class="comment">// 对代码进行转换</span></span><br><span class="line"><span class="keyword">const</span> &#123;babel&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-babel&#x27;</span>)</span><br><span class="line"><span class="comment">// 对代码进行压缩</span></span><br><span class="line"><span class="keyword">const</span> terser = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-terser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postcss = <span class="built_in">require</span>(<span class="string">&#x27;rollup-plugin-postcss&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> vue = <span class="built_in">require</span>(<span class="string">&#x27;rollup-plugin-vue&#x27;</span>)</span><br><span class="line"><span class="comment">// 由于 vue 中使用了 node 环境中的 process 去判断当前的环境是否 production 还是 development</span></span><br><span class="line"><span class="comment">// 所以需要执行该变量 process.env.NODE_ENV</span></span><br><span class="line"><span class="keyword">const</span> replace = <span class="built_in">require</span>(<span class="string">&#x27;rollup-plugin-replace&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口文件</span></span><br><span class="line">  <span class="attr">input</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 打包后的格式</span></span><br><span class="line">    <span class="attr">format</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">    <span class="comment">// 当使用 umd 时，需要执行名称</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="comment">// 输出的文件</span></span><br><span class="line">    <span class="attr">file</span>: <span class="string">&#x27;./build/bundle.umd.js&#x27;</span>,</span><br><span class="line">    <span class="attr">globals</span>: &#123;</span><br><span class="line">      <span class="attr">loadsh</span>: <span class="string">&#x27;_&#x27;</span>,</span><br><span class="line">      <span class="attr">vue</span>: <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// commonjs(),</span></span><br><span class="line">    <span class="title function_">nodeResolve</span>(),</span><br><span class="line">    <span class="title function_">babel</span>(&#123;</span><br><span class="line">      <span class="attr">babelHelpers</span>: <span class="string">&#x27;bundled&#x27;</span>,</span><br><span class="line">      <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// terser(),</span></span><br><span class="line">    <span class="title function_">postcss</span>(&#123;</span><br><span class="line">      <span class="attr">plugins</span>: [<span class="built_in">require</span>(<span class="string">&#x27;postcss-preset-env&#x27;</span>)]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title function_">replace</span>(&#123;</span><br><span class="line">      <span class="string">&#x27;process.env.NODE_ENV&#x27;</span>: <span class="string">&#x27;&quot;development&quot;&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="搭建本地开发服务"><a href="#搭建本地开发服务" class="headerlink" title="搭建本地开发服务"></a>搭建本地开发服务</h3><p>安装对应依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 本地服务</span></span><br><span class="line">npm install rollup-plugin-server -D</span><br><span class="line"><span class="comment"># 监听文件发生变化重新打包</span></span><br><span class="line">npm install rollup-plugin-livereload -D</span><br></pre></td></tr></table></figure>

<p>配置环境</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用该插件可以通过 commonjs 导出，使用 esmodule 方式导入</span></span><br><span class="line"><span class="keyword">const</span> commonjs = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-commonjs&#x27;</span>)</span><br><span class="line"><span class="comment">// 解决 打包 node_modules 文件中的内容</span></span><br><span class="line"><span class="keyword">const</span> nodeResolve = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-node-resolve&#x27;</span>)</span><br><span class="line"><span class="comment">// 对代码进行转换</span></span><br><span class="line"><span class="keyword">const</span> &#123;babel&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-babel&#x27;</span>)</span><br><span class="line"><span class="comment">// 对代码进行压缩</span></span><br><span class="line"><span class="keyword">const</span> terser = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-terser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> html = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-html&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> postcss = <span class="built_in">require</span>(<span class="string">&#x27;rollup-plugin-postcss&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> vue = <span class="built_in">require</span>(<span class="string">&#x27;rollup-plugin-vue&#x27;</span>)</span><br><span class="line"><span class="comment">// 由于 vue 中使用了 node 环境中的 process 去判断当前的环境是否 production 还是 development</span></span><br><span class="line"><span class="comment">// 所以需要执行该变量 process.env.NODE_ENV</span></span><br><span class="line"><span class="keyword">const</span> replace = <span class="built_in">require</span>(<span class="string">&#x27;rollup-plugin-replace&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">&#x27;rollup-plugin-server&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> livereload = <span class="built_in">require</span>(<span class="string">&#x27;rollup-plugin-livereload&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口文件</span></span><br><span class="line">  <span class="attr">input</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 打包后的格式</span></span><br><span class="line">    <span class="attr">format</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">    <span class="comment">// 当使用 umd 时，需要执行名称</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="comment">// 输出的文件</span></span><br><span class="line">    <span class="attr">file</span>: <span class="string">&#x27;./build/bundle.umd.js&#x27;</span>,</span><br><span class="line">    <span class="attr">globals</span>: &#123;</span><br><span class="line">      <span class="attr">loadsh</span>: <span class="string">&#x27;_&#x27;</span>,</span><br><span class="line">      <span class="attr">vue</span>: <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// commonjs(),</span></span><br><span class="line">    <span class="title function_">nodeResolve</span>(),</span><br><span class="line">    <span class="title function_">babel</span>(&#123;</span><br><span class="line">      <span class="attr">babelHelpers</span>: <span class="string">&#x27;bundled&#x27;</span>,</span><br><span class="line">      <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// terser(),</span></span><br><span class="line">    <span class="title function_">postcss</span>(&#123;</span><br><span class="line">      <span class="attr">plugins</span>: [<span class="built_in">require</span>(<span class="string">&#x27;postcss-preset-env&#x27;</span>)]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// html(&#123;</span></span><br><span class="line">    <span class="comment">//   include: &#x27;./index.html&#x27;</span></span><br><span class="line">    <span class="comment">// &#125;),</span></span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title function_">replace</span>(&#123;</span><br><span class="line">      <span class="string">&#x27;process.env.NODE_ENV&#x27;</span>: <span class="string">&#x27;&quot;development&quot;&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">server</span>(&#123;</span><br><span class="line">      <span class="attr">port</span>: <span class="number">8000</span>,</span><br><span class="line">      <span class="attr">contentDir</span>: <span class="string">&#x27;.&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">livereload</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -w: watch</span></span><br><span class="line">npx rollup -c -w</span><br></pre></td></tr></table></figure>

<p>在执行 rollup 命令时，可以指定参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过设定 environment 设置环境变量，可以在 rollup.config.js 文件中 通过 process.env.NODE_ENV 拿到该变量</span></span><br><span class="line">npx rollup --environment NODE_ENV:production</span><br><span class="line">npx rollup --environment NODE_ENV:development</span><br></pre></td></tr></table></figure>



<h2 id="Vite"><a href="#Vite" class="headerlink" title="Vite"></a>Vite</h2><p>由于现在浏览器支持 esmodule 模块化的加载，在开发时，可以直接使用这个特性。但是仍存在如下的问题：</p>
<ul>
<li>在加载文件时，后缀名不能省略</li>
<li>加载别的文件时，该文件的依赖也将会在浏览器中进行下载，导致浏览器下载了很多个文件，占用了很大的带宽</li>
<li>不支持 ts、vue 等代码文件</li>
</ul>
<p>vite 对 css、ts 原生支持。对于 less 的使用，只需要安装 less 插件即可</p>
<h3 id="配置对-vue-的支持"><a href="#配置对-vue-的支持" class="headerlink" title="配置对 vue 的支持"></a>配置对 vue 的支持</h3><p>需要安装配置 vue 的插件 @vite&#x2F;plugin-vue</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @vite/plugin-vue</span><br></pre></td></tr></table></figure>

<p>配置 vite</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&#x27;vite&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> vue = <span class="built_in">require</span>(<span class="string">&#x27;@vitejs/plugin-vue&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="自定义-CLI"><a href="#自定义-CLI" class="headerlink" title="自定义 CLI"></a>自定义 CLI</h2><p>在项目根目录下创建 bin 文件夹，文件夹里面存放 js 代码，在文件头部需要标明执行该文件的环境路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="attr">D</span>:<span class="regexp">/Dahui/</span><span class="title class_">Environment</span>/<span class="title class_">Node</span>/node</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>创建 package.json 文件，并配置 bin ，其中 demo01 表示执行的命令</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cli&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;bin&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;demo01&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bin/test.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>通过 npm link 命令创建一个连接，该命令将会将配置的 bin 生成一个 demo01（linux），demo01.cmd（cmd） 和 demo01.ps1（powershell） 文件，该文件被存放到 node_global 文件夹中，用于执行该命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="built_in">link</span></span><br></pre></td></tr></table></figure>

<p>通过使用 commander 工具来解析传入的参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="attr">D</span>:<span class="regexp">/Dahui/</span><span class="title class_">Environment</span>/<span class="title class_">Node</span>/node</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; program &#125; = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(&#x27;test&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [</span></span><br><span class="line"><span class="comment"> *   &#x27;D:\\Dahui\\Environment\\Node\\node.exe&#x27;, // node 路径</span></span><br><span class="line"><span class="comment"> *   &#x27;D:\\Dahui\\Environment\\Node\\node-v18.14.0-win-x64\\node_global\\node_modules\\cli\\bin\\test.js&#x27;, // 脚本路径</span></span><br><span class="line"><span class="comment"> *   &#x27;--version&#x27; // 参数</span></span><br><span class="line"><span class="comment"> * ]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// console.log(process.argv)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> version = <span class="built_in">require</span>(<span class="string">&#x27;../package.json&#x27;</span>).<span class="property">version</span></span><br><span class="line"></span><br><span class="line">program.<span class="title function_">version</span>(version, <span class="string">&#x27;-V, --version&#x27;</span>)</span><br><span class="line"><span class="comment">// &lt;valuename&gt; 用于传值 valuename 用于表明传值到哪个属性中</span></span><br><span class="line">program.<span class="title function_">option</span>(<span class="string">&#x27;-d, --destination &lt;destination&gt;&#x27;</span>, <span class="string">&#x27;where to put the result&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听 --help 参数，当输入该参数将会执行里面的回调函数</span></span><br><span class="line">program.<span class="title function_">on</span>(<span class="string">&#x27;--help&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;others&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;  1111111&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;  2222222&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">program.<span class="title function_">parse</span>(process.<span class="property">argv</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取对 destination 传入的值</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(program.<span class="title function_">opts</span>().<span class="property">destination</span>)</span><br></pre></td></tr></table></figure>

<h3 id="封装自定义命令，并从远程仓库下载"><a href="#封装自定义命令，并从远程仓库下载" class="headerlink" title="封装自定义命令，并从远程仓库下载"></a>封装自定义命令，并从远程仓库下载</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; program &#125; = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; useHelp &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./core/help&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">useHelp</span>()</span><br><span class="line"></span><br><span class="line">program.<span class="title function_">parse</span>(process.<span class="property">argv</span>)</span><br></pre></td></tr></table></figure>

<p>help.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; program &#125; = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; createFromTemplate, createComponent &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./action&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useHelp</span>(<span class="params"></span>) &#123;</span><br><span class="line">  program</span><br><span class="line">    .<span class="title function_">option</span>(<span class="string">&#x27;-d, --destination &lt;destination&gt;&#x27;</span>, <span class="string">&#x27;the destination of direcotry&#x27;</span>)</span><br><span class="line">    .<span class="title function_">option</span>(<span class="string">&#x27;-r, --remove&#x27;</span>, <span class="string">&#x27;remove the files&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  program</span><br><span class="line">    .<span class="title function_">command</span>(<span class="string">&#x27;create &lt;template&gt; [args]&#x27;</span>)</span><br><span class="line">    .<span class="title function_">description</span>(<span class="string">&#x27;the template of project to create&#x27;</span>)</span><br><span class="line">    .<span class="title function_">action</span>(createFromTemplate)</span><br><span class="line"></span><br><span class="line">  program</span><br><span class="line">    .<span class="title function_">command</span>(<span class="string">&#x27;create-cpn &lt;component&gt; [...args]&#x27;</span>)</span><br><span class="line">    .<span class="title function_">description</span>(<span class="string">&#x27;createt a component from template&#x27;</span>)</span><br><span class="line">    .<span class="title function_">action</span>(createComponent)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  useHelp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>action.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; promisify &#125; = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>)</span><br><span class="line"><span class="comment">// 通过 promisify 使 download 变为一个 promise</span></span><br><span class="line"><span class="keyword">const</span> download = <span class="title function_">promisify</span>(<span class="built_in">require</span>(<span class="string">&#x27;download-git-repo&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> &#123; program &#125; = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>)</span><br><span class="line"><span class="comment">// 添加模板编译库</span></span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">executeCommand</span>(<span class="params">command, args, opts</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;    </span><br><span class="line">    <span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line">    <span class="comment">// 开启子进程</span></span><br><span class="line">    <span class="keyword">const</span> childProcess = <span class="title function_">spawn</span>(command, args, opts)</span><br><span class="line">    <span class="comment">// 将输出传入到主进程的输出</span></span><br><span class="line">    childProcess.<span class="property">stdout</span>.<span class="title function_">pipe</span>(process.<span class="property">stdout</span>)</span><br><span class="line">    childProcess.<span class="property">stderr</span>.<span class="title function_">pipe</span>(process.<span class="property">stderr</span>)</span><br><span class="line"></span><br><span class="line">    childProcess.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;<span class="title function_">resolve</span>()&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createFromTemplate</span>(<span class="params">template, args</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(template, args)</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 参数一：下载地址 需要指定下载的分支</span></span><br><span class="line"><span class="comment">   * 参数二：下载到哪里</span></span><br><span class="line"><span class="comment">   * 参数三：可选参数，设置为 clone 方式</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">download</span>(<span class="string">&#x27;direct:git@github.com:DaHui-BT/scoped-css-webpack-plugin.git#main&#x27;</span>, template, &#123; <span class="attr">clone</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="keyword">let</span> command = <span class="string">&#x27;npm&#x27;</span></span><br><span class="line">  <span class="comment">// 判断当前平台，win 需要添加 .exe</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">platform</span>)</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> == <span class="string">&#x27;win32&#x27;</span>) &#123;</span><br><span class="line">    command += <span class="string">&#x27;.exe&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 自动安装相关的依赖</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">executeCommand</span>(command, [<span class="string">&#x27;install&#x27;</span>], &#123; <span class="attr">cwd</span>: <span class="string">`./<span class="subst">$&#123;template&#125;</span>`</span>&#125;)</span><br><span class="line">  <span class="comment">// 自动运行该项目</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">executeCommand</span>(command, [<span class="string">&#x27;run&#x27;</span>, <span class="string">&#x27;dev&#x27;</span>], &#123; <span class="attr">cwd</span>: <span class="string">`./<span class="subst">$&#123;template&#125;</span>`</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createComponent</span>(<span class="params">component, args</span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> templatePath = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./template/template.vue.ejs&#x27;</span>)</span><br><span class="line">    <span class="comment">// 编译模板，并传入需要替换的字符</span></span><br><span class="line">    ejs.<span class="title function_">renderFile</span>(templatePath, &#123; <span class="attr">name</span>: component, <span class="attr">lowerName</span>: component.<span class="title function_">toLowerCase</span>() &#125;, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="title function_">reject</span>(err)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(result)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">async</span> res =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> destination = program.<span class="title function_">opts</span>().<span class="property">destination</span> || <span class="string">&#x27;./&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(__dirname, destination)</span><br><span class="line">    <span class="comment">// 判断文件路径是否存在，不存在则创建</span></span><br><span class="line">    <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(filePath)) &#123;</span><br><span class="line">      fs.<span class="title function_">mkdirSync</span>(filePath)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 同步写入文件</span></span><br><span class="line">    <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">writeFile</span>(<span class="string">`<span class="subst">$&#123;filePath&#125;</span>/<span class="subst">$&#123;component&#125;</span>.vue`</span>, res)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  createFromTemplate,</span><br><span class="line">  createComponent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a><a target="_blank" rel="noopener" href="https://www.aliyundrive.com/drive/file/all/backup/66f25f1481f8a5c9b2ec48bdb4953a2c7483f60a">TODO</a></h1><p>802 day134_Rollup-Vite打包与原理-脚手架开发_14_(掌握)vite-esbuild构建工具的原理解析.mp4 </p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://localhost:4000">DH</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://localhost:4000/2025/04/08/learn/">http://localhost:4000/2025/04/08/learn/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Node/">Node</a></div><div class="post-share"><div class="social-share" data-image="/images/favicon.ico" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/19/react/" title="React 学习笔记"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">React 学习笔记</div></div><div class="info-2"><div class="info-item-1">React 学习第一站一个简单的例子 12345678910111213141516171819202122232425262728293031323334353637&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;  &lt;meta charset=&quot;UTF-8&quot;&gt;  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;  &lt;title&gt;Document&lt;/title&gt;&lt;/head&gt;&lt;body&gt;  &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;    &lt;script crossorigin src=&quot;https://unpkg.com/react@18/umd/react.development.js&quot;&gt;&lt;/s...</div></div></div></a><a class="pagination-related" href="/2025/04/08/css/" title="CSS 高级"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">CSS 高级</div></div><div class="info-2"><div class="info-item-1">CSS 优先级 style 标签内的样式 &gt; link 引入外部 css 的样式 px、em、rem em 相对于父元素中设置的字体大小 rem 相对于根标签（html）继承大小 H5 移动端 PostCSS BFC块级格式化上下文（Block Formatting Context），它是浏览器在渲染的过程中用于组织块级元素的一个独立渲染区域 触发 BFC 方式  float 的值不是 none。 position 的值不是 static 或者 relative。 display 的值是 inline-block、table-cell、flex、table-caption 或者inline-flex overflow 的值不是 visible  为了解决：  外边距合并 浮动元素的影响 文字环绕效果 防止外边距穿透  Flex、GridCanvasTransformTransitionAnimationKeyFramePosition媒体查询 MediaSass、Less、CSS</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/favicon.ico" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">DH</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-js"><span class="toc-number">1.</span> <span class="toc-text">Node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#path-%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.</span> <span class="toc-text">path 模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CommonJS"><span class="toc-number">2.</span> <span class="toc-text">CommonJS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exports-%E4%B8%8E-module-exports"><span class="toc-number">2.1.</span> <span class="toc-text">exports 与 module.exports</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E6%9F%A5%E6%89%BE%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.</span> <span class="toc-text">路径查找问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E5%BC%95%E7%94%A8"><span class="toc-number">2.3.</span> <span class="toc-text">导出引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#module-%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.4.</span> <span class="toc-text">module 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number">2.5.</span> <span class="toc-text">加载过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES-Module"><span class="toc-number">3.</span> <span class="toc-text">ES-Module</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">导入导出方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E4%BC%98%E5%8C%96"><span class="toc-number">3.2.</span> <span class="toc-text">导入导出优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%AF%BC%E5%87%BA"><span class="toc-number">3.3.</span> <span class="toc-text">默认导出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">导入函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B-TODO"><span class="toc-number">3.5.</span> <span class="toc-text">解析流程 TODO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npm"><span class="toc-number">4.</span> <span class="toc-text">npm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scripts-%E8%84%9A%E6%9C%AC"><span class="toc-number">4.1.</span> <span class="toc-text">scripts 脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E4%BE%9D%E8%B5%96%E3%80%81%E7%94%9F%E4%BA%A7%E4%BE%9D%E8%B5%96"><span class="toc-number">4.2.</span> <span class="toc-text">开发依赖、生产依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="toc-number">4.3.</span> <span class="toc-text">版本管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">4.4.</span> <span class="toc-text">命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npx"><span class="toc-number">5.</span> <span class="toc-text">npx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pnpm"><span class="toc-number">6.</span> <span class="toc-text">pnpm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webpack-%E6%A8%A1%E5%9D%97%E5%8C%96%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7"><span class="toc-number">7.</span> <span class="toc-text">Webpack 模块化打包工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">7.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%90%8E%E7%BC%80%E5%90%8D"><span class="toc-number">7.2.</span> <span class="toc-text">配置后缀名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.3.</span> <span class="toc-text">打包模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML-webpack-plugin"><span class="toc-number">7.4.</span> <span class="toc-text">HTML webpack plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9-React-%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E6%89%93%E5%8C%85"><span class="toc-number">7.5.</span> <span class="toc-text">对 React 代码进行打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9-TS-%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E6%89%93%E5%8C%85"><span class="toc-number">7.6.</span> <span class="toc-text">对 TS 文件进行打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-Map"><span class="toc-number">7.7.</span> <span class="toc-text">Source Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#devtool-%E9%80%89%E9%A1%B9"><span class="toc-number">7.8.</span> <span class="toc-text">devtool 选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8F%92%E4%BB%B6"><span class="toc-number">7.9.</span> <span class="toc-text">配置插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E7%BC%96%E8%AF%91"><span class="toc-number">7.10.</span> <span class="toc-text">自动化编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Webpack-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">7.11.</span> <span class="toc-text">Webpack 性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%86%E5%8C%85%E5%A4%84%E7%90%86"><span class="toc-number">7.11.1.</span> <span class="toc-text">1. 分包处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prefetch-%E5%92%8C-Preload"><span class="toc-number">7.12.</span> <span class="toc-text">Prefetch 和 Preload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shimming"><span class="toc-number">7.13.</span> <span class="toc-text">Shimming</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9-CSS-%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E5%8D%95%E7%8B%AC%E6%8F%90%E5%8F%96"><span class="toc-number">7.14.</span> <span class="toc-text">对 CSS 文件进行单独提取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash%E3%80%81ContentHash%E3%80%81ChunkHash"><span class="toc-number">7.15.</span> <span class="toc-text">Hash、ContentHash、ChunkHash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DLL-%E5%BA%93"><span class="toc-number">7.16.</span> <span class="toc-text">DLL 库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Terser"><span class="toc-number">7.17.</span> <span class="toc-text">Terser</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">7.17.1.</span> <span class="toc-text">命令行使用方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-webpack-%E4%B8%AD%E9%85%8D%E7%BD%AE-terser"><span class="toc-number">7.17.2.</span> <span class="toc-text">在 webpack 中配置 terser</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSS-%E5%8E%8B%E7%BC%A9"><span class="toc-number">7.18.</span> <span class="toc-text">CSS 压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E6%8B%86%E5%88%86"><span class="toc-number">7.19.</span> <span class="toc-text">webpack 配置文件的拆分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TreeShaking"><span class="toc-number">7.20.</span> <span class="toc-text">TreeShaking</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CSS-tree-shaking"><span class="toc-number">7.20.1.</span> <span class="toc-text">CSS tree shaking</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scope-Hosting"><span class="toc-number">7.21.</span> <span class="toc-text">Scope Hosting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-%E5%8E%8B%E7%BC%A9"><span class="toc-number">7.22.</span> <span class="toc-text">HTTP 压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gzip-%E5%8E%8B%E7%BC%A9"><span class="toc-number">7.23.</span> <span class="toc-text">Gzip 压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML-%E5%8E%8B%E7%BC%A9"><span class="toc-number">7.24.</span> <span class="toc-text">HTML 压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E4%BA%8E%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90"><span class="toc-number">7.25.</span> <span class="toc-text">针对于打包过程进行分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%89%93%E5%8C%85%E5%90%8E%E7%9A%84%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90"><span class="toc-number">7.26.</span> <span class="toc-text">对打包后的文件进行分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webpack-%E6%BA%90%E7%A0%81"><span class="toc-number">8.</span> <span class="toc-text">Webpack 源码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#createCompiler"><span class="toc-number">8.1.</span> <span class="toc-text">createCompiler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-number">8.2.</span> <span class="toc-text">webpack 解析过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Loader"><span class="toc-number">8.3.</span> <span class="toc-text">自定义 Loader</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#callback-%E5%87%BD%E6%95%B0"><span class="toc-number">8.3.1.</span> <span class="toc-text">callback 函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#async-%E5%87%BD%E6%95%B0%EF%BC%88%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0%EF%BC%89"><span class="toc-number">8.3.2.</span> <span class="toc-text">async 函数（异步函数）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99-loader-%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="toc-number">8.3.3.</span> <span class="toc-text">给 loader 传递参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E4%BC%A0%E5%85%A5%E7%9A%84%E5%8F%82%E6%95%B0%E8%BF%9B%E8%A1%8C%E6%A0%A1%E9%AA%8C"><span class="toc-number">8.3.4.</span> <span class="toc-text">对传入的参数进行校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#markdown-loader"><span class="toc-number">8.3.5.</span> <span class="toc-text">markdown loader</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6"><span class="toc-number">8.4.</span> <span class="toc-text">自定义插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Tapable"><span class="toc-number">8.4.1.</span> <span class="toc-text">Tapable</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Babel"><span class="toc-number">9.</span> <span class="toc-text">Babel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86"><span class="toc-number">9.1.</span> <span class="toc-text">解析原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E8%AE%BE"><span class="toc-number">9.2.</span> <span class="toc-text">预设</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babel-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">9.3.</span> <span class="toc-text">babel 配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Browserslist-%E6%8F%92%E4%BB%B6"><span class="toc-number">10.</span> <span class="toc-text">Browserslist 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">10.1.</span> <span class="toc-text">使用方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Polyfill"><span class="toc-number">11.</span> <span class="toc-text">Polyfill</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CDN-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">12.</span> <span class="toc-text">CDN 服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gulp"><span class="toc-number">13.</span> <span class="toc-text">Gulp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">13.1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-gulp-%E4%BB%BB%E5%8A%A1"><span class="toc-number">13.2.</span> <span class="toc-text">创建 gulp 任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%BB%BB%E5%8A%A1"><span class="toc-number">13.3.</span> <span class="toc-text">多任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">13.4.</span> <span class="toc-text">读写文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9-Js-%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E8%BD%AC%E5%8C%96%E5%92%8C%E5%8E%8B%E7%BC%A9"><span class="toc-number">13.5.</span> <span class="toc-text">对 Js 文件进行转化和压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">13.6.</span> <span class="toc-text">搭建项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rollup"><span class="toc-number">14.</span> <span class="toc-text">Rollup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rollup-VS-webpack"><span class="toc-number">14.1.</span> <span class="toc-text">rollup VS webpack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rollup-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">14.2.</span> <span class="toc-text">rollup 基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86-CSS-%E6%96%87%E4%BB%B6"><span class="toc-number">14.3.</span> <span class="toc-text">处理 CSS 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9-vue-%E8%BF%9B%E8%A1%8C%E6%89%93%E5%8C%85"><span class="toc-number">14.4.</span> <span class="toc-text">对 vue 进行打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1"><span class="toc-number">14.5.</span> <span class="toc-text">搭建本地开发服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vite"><span class="toc-number">15.</span> <span class="toc-text">Vite</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AF%B9-vue-%E7%9A%84%E6%94%AF%E6%8C%81"><span class="toc-number">15.1.</span> <span class="toc-text">配置对 vue 的支持</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-CLI"><span class="toc-number">16.</span> <span class="toc-text">自定义 CLI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E8%87%AA%E5%AE%9A%E4%B9%89%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%B9%B6%E4%BB%8E%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E4%B8%8B%E8%BD%BD"><span class="toc-number">16.1.</span> <span class="toc-text">封装自定义命令，并从远程仓库下载</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TODO"><span class="toc-number"></span> <span class="toc-text">TODO</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/07/test/" title="test">test</a><time datetime="2025-09-07T09:36:15.000Z" title="Created 2025-09-07 17:36:15">2025-09-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/25/seo/" title="搜索引擎优化">搜索引擎优化</a><time datetime="2025-04-25T15:31:42.000Z" title="Created 2025-04-25 23:31:42">2025-04-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/19/react/" title="React 学习笔记">React 学习笔记</a><time datetime="2025-04-19T12:31:42.000Z" title="Created 2025-04-19 20:31:42">2025-04-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/08/learn/" title="Node 学习笔记">Node 学习笔记</a><time datetime="2025-04-08T15:31:42.000Z" title="Created 2025-04-08 23:31:42">2025-04-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/08/css/" title="CSS 高级">CSS 高级</a><time datetime="2025-04-08T05:31:42.000Z" title="Created 2025-04-08 13:31:42">2025-04-08</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By DH</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>